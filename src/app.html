<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="description" content="An online reference for pokemon dungeons and dragons homebrew!" />

		<meta name="theme-color" content="#ffca04" />
		<link rel="apple-touch-icon" sizes="192x192" href="%sveltekit.assets%/icons/192.png" />
		<link rel="shortcut icon" href="%sveltekit.assets%/icons/032.png" />

		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet" />

		<link rel="stylesheet" href="%sveltekit.assets%/styles/normalize.css" />
		<link rel="stylesheet" href="%sveltekit.assets%/styles/global.css" />
		<link rel="manifest" href="%sveltekit.assets%/poke5e.webmanifest" />

		%sveltekit.head%
	</head>
	<body>
		<div>%sveltekit.body%</div>
		<script>
			function migrateData() {
				const target = "poke5e"
				const hasMigrated = localStorage.getItem("migrated") != null || localStorage.getItem("trainers") != null
				if (!hasMigrated) {
					const iframe = document.createElement("iframe")

					window.addEventListener("message", (event) => {
						console.log(event.origin)
						if (event.origin !== "https://auroratide.github.io") return
						if (!Array.isArray(event.data)) return

						console.log("Migrating data to new domain...")
						event.data.forEach(([key, value]) => {
							localStorage.setItem(key, value)
						})

						localStorage.setItem("migrated", "true")
						console.log("...Done migrating!")

						iframe.remove()
					}, { once: true })

					iframe.style.position = "absolute"
					iframe.style.width = "1px"
					iframe.style.height = "1px"
					iframe.style.clipPath = "inset(50%)"
					iframe.style.overflow = "hidden"
					iframe.style.left = "-9999px"
					iframe.src = `https://auroratide.github.io/storage-migration/${target}`

					document.body.appendChild(iframe)
				}
			}

			if (window.location.origin === "https://poke5e.app") {
				migrateData()
			}
		</script>
	</body>
</html>
