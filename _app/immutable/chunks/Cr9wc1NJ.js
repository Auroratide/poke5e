var D=Object.defineProperty;var U=(t,e,s)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var o=(t,e,s)=>U(t,typeof e!="symbol"?e+"":e,s);import{r as L,w as H,d as S}from"./BkWn0woc.js";import{D as c}from"./Bf-g66YD.js";import{G as j,S as G,E as $,H as z,A as M,a as k}from"./BKIoMsJF.js";import"./ER4uO_3S.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{b as C}from"./D9WYgC9r.js";import{P as F}from"./BvYn8y2u.js";import"./CdRAs_Ty.js";/* empty css        */import"./CwPgVoZy.js";import{e as O,P as B,s as N}from"./C-Jj-fB-.js";/* empty css        *//* empty css        */import"./DKjyhwJX.js";import"./CtXL00bx.js";/* empty css        *//* empty css        *//* empty css        */class u extends c{isFakemon(){return this.data.startsWith("F.")}toFakemonReadKey(){if(!this.isFakemon())throw new Error("Attempted to convert non-fakemon species identifier into a fakemon read key.");return this.data.substring(2)}static fromSpeciesName(e){return new u(e)}static fromFakemonReadKey(e){return new u(`F.${e}`)}}const I={Tiny:"tiny",Small:"small",Medium:"medium",Large:"large",Huge:"huge",Gargantuan:"gargantuan"};function W(t){return Object.values(I).includes(t)}class _ extends c{constructor(){super(...arguments);o(this,"mergeWith",s=>{const i=Object.fromEntries(Object.entries(s.data).filter(([,r])=>r!=null)),a={...this.data,...i};return new this.constructor(a)})}static fromList(s,i){return new s(i.reduce((a,r)=>({...a,[r.type]:r.value}),{}))}}class K extends _{}o(K,"types",{Walking:"walking",Climbing:"climbing",Swimming:"swimming",Flying:"flying",Hover:"hover",Burrowing:"burrowing"});class P extends _{}o(P,"types",{Darkvision:"darkvision",Blindsight:"blindsight",Tremorsense:"tremorsense",Truesight:"truesight"});class g extends c{toList(){return this.data.normal.map(e=>({id:e,hidden:!1})).concat(this.data.hidden.map(e=>({id:e,hidden:!0})))}isEmpty(){return this.data.normal.length===0&&this.data.hidden.length===0}static fromList(e){return new g({normal:e.filter(s=>!s.hidden).map(s=>s.id),hidden:e.filter(s=>s.hidden).map(s=>s.id)})}}const ze=L(void 0,t=>{typeof window<"u"&&fetch(`${C}/abilities.json`).then(e=>e.json()).then(e=>t(e.abilities))}),v=class v extends c{portrait({shiny:e=!1}={}){return e&&this.data.values.shinyPortrait!==void 0?{value:this.data.values.shinyPortrait,hueRotate:0}:e&&this.data.values.shinyPortrait===void 0?{value:this.data.values.normalPortrait,hueRotate:this.customization.shinyHue}:{value:this.data.values.normalPortrait,hueRotate:0}}sprite({shiny:e=!1}={}){return e&&this.data.values.shinySprite!==void 0?{value:this.data.values.shinySprite,hueRotate:0,portraitFallback:!1}:this.data.values.normalSprite!==void 0?{value:this.data.values.normalSprite,hueRotate:e?this.customization.shinyHue:0,portraitFallback:!1}:e&&this.data.values.shinyPortrait!==void 0?{value:this.data.values.shinyPortrait,hueRotate:0,portraitFallback:!0}:{value:this.data.values.normalPortrait,hueRotate:e?this.customization.shinyHue:0,portraitFallback:!0}}hasAnyMedia(){return Object.values(this.data.values).some(e=>e!=null)}get customization(){return this.data.customization??{shinyHue:0}}static forEachType(e){return new v({values:v.types.reduce((s,i)=>({...s,[i]:e(i)}),{})})}};o(v,"types",["normalPortrait","normalSprite","shinyPortrait","shinySprite"]);let d=v;class J extends c{}class f extends c{get id(){return new u(this.data.id)}get type(){return new F(this.data.type)}get gender(){return new j(this.data.gender)}get sr(){return new G(this.data.sr)}get eggGroups(){return new $(this.data.eggGroups)}get hitDice(){return new z(this.data.hitDice)}get speed(){return new K(this.data.speed)}get senses(){return new P(this.data.senses)}get attributes(){return new M(this.data.attributes)}get skills(){return new k(this.data.skills)}get media(){return new d(this.data.media)}get moves(){return new J(this.data.moves)}get abilities(){return new g(this.data.abilities)}numberAsString(){return`#${this.data.number.toString().padStart(4,"0")}`}static fromJson(e){return new f({id:u.fromSpeciesName(e.id).data,name:e.name,number:e.number,type:e.type,size:e.size,sr:e.sr,minLevel:e.minLevel,eggGroups:e.eggGroup,gender:e.gender,description:e.description,ac:e.ac,hp:e.hp,hitDice:e.hitDice,speed:_.fromList(K,e.speed).data,senses:_.fromList(P,e.senses).data,attributes:e.attributes,skills:k.fromList(e.skills).data,saves:e.savingThrows,abilities:g.fromList(e.abilities).data,moves:e.moves,media:{values:{normalPortrait:{name:e.media.main,href:e.media.main},normalSprite:e.media.sprite?{name:e.media.sprite,href:e.media.sprite}:void 0,shinyPortrait:e.media.mainShiny?{name:e.media.mainShiny,href:e.media.mainShiny}:void 0,shinySprite:e.media.spriteShiny?{name:e.media.spriteShiny,href:e.media.spriteShiny}:void 0},customization:{shinyHue:0},attribution:e.media.attribution?{href:e.media.attribution}:void 0},evolution:e.evolution})}}class Q{constructor(e,s){o(this,"info",async(e,s)=>{try{if(s.media!=null){const i=await this.provider.updateMedia(e.data.writeKey,s.media);d.types.forEach(a=>{var r,n;((r=s.media.data.values[a])==null?void 0:r.type)==="remove"?e.data.species.media.values[a]=void 0:((n=s.media.data.values[a])==null?void 0:n.type)==="new"&&(e.data.species.media.values[a]=i.data.values[a])})}await this.provider.update(e),this.fakemonStore.update(i=>({...i,[e.data.readKey]:{value:e,update:this}}))}catch(i){throw O.show(i.message),i}});this.provider=e,this.fakemonStore=s}}class Y{constructor(e){o(this,"upload",async(e,s)=>{const i=await fetch(e,{method:"PUT",body:s,headers:{"Content-Type":s.type,"Content-Length":s.size.toString()}});if(!i.ok)throw console.error(await i.text()),new V("Could not upload file.")});this.baseUrl=e}getAssetUrl(e){return`${this.baseUrl}/${e}`}}class V extends Error{constructor(e,s){super(e+(s!=null&&s.code?` Code: ${s.code}`:"")),this.diagnostics=s}}const X=new Y(B);class h extends Error{constructor(e){super(e)}}class q extends h{constructor(){super("You do not have permission to edit this pokemon.")}}class b extends c{get species(){return new f(this.data.species)}}o(b,"alphabetical",(e,s)=>e.data.species.name.localeCompare(s.data.species.name));const T="fakemon::",E=t=>`${T}${t}`;function R(t){const e=E(t),s=localStorage.getItem(e);if(s!=null)try{return{...JSON.parse(s),readKey:t}}catch(i){console.warn(i);return}}function Z(t){const e=R(t.readKey),s=E(t.readKey);localStorage.setItem(s,JSON.stringify({id:t.id??(e==null?void 0:e.id),writeKey:t.writeKey??(e==null?void 0:e.writeKey)}))}function ee(){const t=[];for(let e=0;e<localStorage.length;++e){const s=localStorage.key(e);if(!s.startsWith(T))continue;const i=R(s.split("::")[1]);i!=null&&t.push(i)}return t}function te(t){const e=E(t);localStorage.removeItem(e)}const p={get:R,add:Z,list:ee,remove:te};class se{constructor(e,s){o(this,"handleNewMedia",async(e,s)=>{var r;const{data:i,error:a}=await this.supabase.functions.invoke("user-assets",{method:"POST",body:{type:"fakemon-media",params:{key:e,...(r=d.forEachType(n=>{var l;return((l=s.data.values[n])==null?void 0:l.type)==="new"?{mimetype:s.data.values[n].value.type,sizeInBytes:s.data.values[n].value.size}:void 0}))==null?void 0:r.data.values}}});if(a)throw new h("Could not upload file(s) for fakemon.");return await Promise.all(d.types.map(n=>{var l;return i.values[n]!=null&&((l=s.data.values[n])==null?void 0:l.type)==="new"?this.userAssets.upload(i.values[n].uploadUrl,s.data.values[n].value):void 0}).filter(n=>n!=null)),d.forEachType(n=>{var l;return i.values[n]!=null&&((l=s.data.values[n])==null?void 0:l.type)==="new"?this.getUserAssetResource(i.values[n].filename):void 0})});o(this,"handleRemovedMedia",async(e,s)=>{const{error:i}=await this.supabase.functions.invoke("user-assets",{method:"DELETE",body:{type:"fakemon-media",params:{key:e,...d.forEachType(a=>{var r;return((r=s.data.values[a])==null?void 0:r.type)==="remove"}).data.values}}});if(i)throw new h("Could not remove file(s) for fakemon.")});o(this,"getUserAssetResource",e=>({name:e,href:this.userAssets.getAssetUrl(e)}));this.supabase=e,this.userAssets=s}async getAllKnown(){return Promise.all(p.list().map(e=>this.getByReadKey(e.readKey))).then(e=>e.filter(s=>s!=null))}async getByReadKey(e){return this.supabase.rpc("get_fakemon",{_read_key:e}).maybeSingle().then(({data:s,error:i})=>{if(this.validateError("Could not get fakemon.",i),!s)return;const a=ae(s,this.getUserAssetResource),r=p.get(e);return a.data.writeKey=r==null?void 0:r.writeKey,p.add(a.data),a})}async add(e){const{data:s,error:i}=await this.supabase.rpc("new_fakemon",this.toQuery(e)).single();this.validateError("Could not add fakemon.",i);const a={id:s.ret_id,readKey:s.ret_read_key,writeKey:s.ret_write_key};return p.add(a),new b({species:{...e,id:u.fromFakemonReadKey(a.readKey).data},...a})}async update(e){const s=e.data.writeKey;if(s==null)throw new q;const{data:i,error:a}=await this.supabase.rpc("update_fakemon",{_write_key:s,...this.toQuery(e.data.species)}).single();return this.validateError("Could not edit fakemon.",a),i>0}async updateMedia(e,s){const[i]=await Promise.all([this.handleNewMedia(e,s),this.handleRemovedMedia(e,s)]);return i}async verifyWriteKey(e,s){const{data:i,error:a}=await this.supabase.rpc("verify_fakemon_write_key",{_id:e.data.id,_write_key:s}).single();if(a)throw new h("Could not verify fakemon.");return i>0&&p.add({id:e.data.id,readKey:e.data.readKey,writeKey:s}),i>0}validateError(e,s){if(s)throw console.error(s),new h(e)}toQuery(e){var s;return{_species_name:e.name,_type:e.type,_size:e.size,_sr:e.sr,_min_level:e.minLevel,_egg_groups:e.eggGroups,_gender:e.gender,_description:e.description,_ac:e.ac,_hp:e.hp,_hit_dice:e.hitDice,_speed_walking:e.speed.walking??0,_speed_climbing:e.speed.climbing??0,_speed_swimming:e.speed.swimming??0,_speed_flying:e.speed.flying??0,_speed_hover:e.speed.hover??0,_speed_burrowing:e.speed.burrowing??0,_sense_darkvision:e.senses.darkvision??0,_sense_blindsight:e.senses.blindsight??0,_sense_tremorsense:e.senses.tremorsense??0,_sense_truesight:e.senses.truesight??0,_strength:e.attributes.str,_dexterity:e.attributes.dex,_constitution:e.attributes.con,_intelligence:e.attributes.int,_wisdom:e.attributes.wis,_charisma:e.attributes.cha,_prof_athletics:e.skills.athletics>0,_prof_acrobatics:e.skills.acrobatics>0,_prof_sleight_of_hand:e.skills["sleight of hand"]>0,_prof_stealth:e.skills.stealth>0,_prof_arcana:e.skills.arcana>0,_prof_history:e.skills.history>0,_prof_investigation:e.skills.investigation>0,_prof_nature:e.skills.nature>0,_prof_religion:e.skills["religion fakemon"]>0,_prof_animal_handling:e.skills["animal handling"]>0,_prof_insight:e.skills.insight>0,_prof_medicine:e.skills.medicine>0,_prof_perception:e.skills.perception>0,_prof_survival:e.skills.survival>0,_prof_deception:e.skills.deception>0,_prof_intimidation:e.skills.intimidation>0,_prof_performance:e.skills.performance>0,_prof_persuasion:e.skills.persuasion>0,_save_str:e.saves.includes("str"),_save_dex:e.saves.includes("dex"),_save_con:e.saves.includes("con"),_save_int:e.saves.includes("int"),_save_wis:e.saves.includes("wis"),_save_cha:e.saves.includes("cha"),_abilities:e.abilities.normal,_hidden_abilities:e.abilities.hidden,_moves_start:e.moves.start,_moves_level2:e.moves.level2,_moves_level6:e.moves.level6,_moves_level10:e.moves.level10,_moves_level14:e.moves.level14,_moves_level18:e.moves.level18,_moves_egg:e.moves.egg,_moves_tm:e.moves.tm,_art_attribution_name:null,_art_attribution_href:null,_shiny_hue_rotation:((s=e.media.customization)==null?void 0:s.shinyHue)??0}}}const ie=t=>Object.entries(t).filter(([,e])=>e).map(([e])=>e);function ae(t,e){return new b({id:t.id,readKey:t.read_key,writeKey:t.write_key,species:{id:u.fromFakemonReadKey(t.read_key).data,name:t.species_name,type:t.type.filter(F.isPokeType),number:0,size:W(t.size)?t.size:"small",sr:parseFloat(t.sr),minLevel:t.min_level,eggGroups:t.egg_groups,gender:t.gender,description:t.description,ac:t.ac,hp:t.hp,hitDice:z.isHitDice(t.hit_dice)?t.hit_dice:"d6",speed:{walking:t.speed_walking,swimming:t.speed_swimming,climbing:t.speed_climbing,flying:t.speed_flying,hover:t.speed_hover,burrowing:t.speed_burrowing},senses:{darkvision:t.sense_darkvision,blindsight:t.sense_blindsight,tremorsense:t.sense_tremorsense,truesight:t.sense_truesight},attributes:{str:t.strength,dex:t.dexterity,con:t.constitution,int:t.intelligence,wis:t.wisdom,cha:t.charisma},skills:{athletics:t.prof_athletics?1:0,acrobatics:t.prof_acrobatics?1:0,"sleight of hand":t.prof_sleight_of_hand?1:0,stealth:t.prof_stealth?1:0,arcana:t.prof_arcana?1:0,history:t.prof_history?1:0,investigation:t.prof_investigation?1:0,nature:t.prof_nature?1:0,religion:t.prof_religion?1:0,"animal handling":t.prof_animal_handling?1:0,insight:t.prof_insight?1:0,medicine:t.prof_medicine?1:0,perception:t.prof_perception?1:0,survival:t.prof_survival?1:0,deception:t.prof_deception?1:0,intimidation:t.prof_intimidation?1:0,performance:t.prof_performance?1:0,persuasion:t.prof_persuasion?1:0},saves:ie({str:t.save_str,dex:t.save_dex,con:t.save_con,int:t.save_int,wis:t.save_wis,cha:t.save_cha}),abilities:{normal:t.abilities,hidden:t.hidden_abilities},moves:{start:t.moves_start,level2:t.moves_level2,level6:t.moves_level6,level10:t.moves_level10,level14:t.moves_level14,level18:t.moves_level18,egg:t.moves_egg,tm:t.moves_tm},media:{values:{normalPortrait:t.normal_portrait_filename?e(t.normal_portrait_filename):void 0,normalSprite:t.normal_sprite_filename?e(t.normal_sprite_filename):void 0,shinyPortrait:t.shiny_portrait_filename?e(t.shiny_portrait_filename):void 0,shinySprite:t.shiny_sprite_filename?e(t.shiny_sprite_filename):void 0},customization:{shinyHue:t.shiny_hue_rotation}}}})}const m=new se(N,X);function y(t,e){return{value:t,update:t.data.writeKey!=null?new Q(m,e):void 0}}function x(t,e){return{subscribe:s=>e.subscribe(i=>{s(i[t.value.data.readKey]??t)}),verifyAccess:async s=>{const i=await m.verifyWriteKey(t.value,s);return i&&e.update(a=>({...a,[t.value.data.readKey]:y(t.value.copy({writeKey:s}),e)})),i},remove:async()=>{e.update(s=>{const{[t.value.data.readKey]:i,...a}=s;return a}),p.remove(t.value.data.readKey)}}}function re(t,e){let s=!1;return{subscribe:i=>e.subscribe(a=>{i(Object.values(a).map(r=>r.value).sort(b.alphabetical)),s||(s=!0,e.update(r=>t.reduce((n,l)=>({...n,[l.data.readKey]:y(l,e)}),r)))})}}function ne(){const t=H({}),e={};let s;return{get:async i=>(e[i]==null&&(e[i]=m.getByReadKey(i).then(a=>{if(a==null)return;const r=y(a,t);return t.update(n=>({...n,[a.data.readKey]:r})),x(r,t)})),e[i]),new:async i=>m.add(i).then(a=>{const r=y(a,t),n=x(r,t);return e[a.data.readKey]=Promise.resolve(n),t.update(l=>({...l,[a.data.readKey]:r})),a}),all:async()=>(s==null&&(s=m.getAllKnown().then(i=>re(i,t))),s),reset:async()=>{t.set({})}}}const A=ne(),w=L(void 0,t=>{typeof window<"u"&&fetch(`${C}/pokemon.json`).then(e=>e.json()).then(e=>e.items.map(s=>f.fromJson(s))).then(e=>t(e))});function le(){return{get:async t=>{if(t.isFakemon()){const e=await A.get(t.toFakemonReadKey());return e==null?void 0:S(e,s=>({value:s.value.species}))}else return S(w,e=>{const s=e==null?void 0:e.find(i=>i.id.data===t.data);if(s!=null)return{value:s}})},canonList:()=>w,completeList:async()=>{const t=await A.all();return S([w,t],([e,s])=>e==null?void 0:e.concat(s.map(i=>i.species)))}}}const Ce=le();export{I as C,b as F,f as P,Ce as S,ze as a,d as b,K as c,P as d,u as e,A as f,W as i,X as u};
