var M=Object.defineProperty;var N=(t,e,i)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var l=(t,e,i)=>N(t,typeof e!="symbol"?e+"":e,i);import{r as H,w as G,d as S}from"./DTQkIqjO.js";import{D as c}from"./Bf-g66YD.js";import{G as W,a as J,E as Q,H as j,A as V,S as T}from"./B3TgptHF.js";import"./IHki7fMi.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        *//* empty css        */import{b as B}from"./CVBMDti_.js";import{P as O}from"./BvYn8y2u.js";import"./CdRAs_Ty.js";/* empty css        *//* empty css        *//* empty css        */import"./BXO7SFNG.js";import{e as Y,P as X,s as q}from"./EOlf6Gyd.js";/* empty css        *//* empty css        */import"./DKjyhwJX.js";import"./BMmBTM9x.js";/* empty css        *//* empty css        *//* empty css        */class u extends c{isFakemon(){return this.data.startsWith("F.")}toFakemonReadKey(){if(!this.isFakemon())throw new Error("Attempted to convert non-fakemon species identifier into a fakemon read key.");return this.data.substring(2)}static fromSpeciesName(e){return new u(e)}static fromFakemonReadKey(e){return new u(`F.${e}`)}}const Z={Tiny:"tiny",Small:"small",Medium:"medium",Large:"large",Huge:"huge",Gargantuan:"gargantuan"};function ee(t){return Object.values(Z).includes(t)}class v extends c{constructor(){super(...arguments);l(this,"mergeWith",i=>{const s=Object.fromEntries(Object.entries(i.data).filter(([,r])=>r!=null)),a={...this.data,...s};return new this.constructor(a)})}static fromList(i,s){return new i(s.reduce((a,r)=>({...a,[r.type]:r.value}),{}))}}class P extends v{}l(P,"types",{Walking:"walking",Climbing:"climbing",Swimming:"swimming",Flying:"flying",Hover:"hover",Burrowing:"burrowing"});class w extends v{}l(w,"types",{Darkvision:"darkvision",Blindsight:"blindsight",Tremorsense:"tremorsense",Truesight:"truesight"});class y extends c{toList(){return this.data.normal.map(e=>({id:e,hidden:!1})).concat(this.data.hidden.map(e=>({id:e,hidden:!0})))}isEmpty(){return this.data.normal.length===0&&this.data.hidden.length===0}static fromList(e){return new y({normal:e.filter(i=>!i.hidden).map(i=>i.id),hidden:e.filter(i=>i.hidden).map(i=>i.id)})}}const Ie=H(void 0,t=>{typeof window<"u"&&fetch(`${B}/abilities.json`).then(e=>e.json()).then(e=>t(e.abilities))}),h=class h extends c{portrait({shiny:e=!1}={}){return e&&this.data.values.shinyPortrait!==void 0?{value:this.data.values.shinyPortrait,hueRotate:0}:e&&this.data.values.shinyPortrait===void 0?{value:this.data.values.normalPortrait,hueRotate:this.customization.shinyHue}:{value:this.data.values.normalPortrait,hueRotate:0}}sprite({shiny:e=!1}={}){return e&&this.data.values.shinySprite!==void 0?{value:this.data.values.shinySprite,hueRotate:0,portraitFallback:!1}:this.data.values.normalSprite!==void 0?{value:this.data.values.normalSprite,hueRotate:e?this.customization.shinyHue:0,portraitFallback:!1}:e&&this.data.values.shinyPortrait!==void 0?{value:this.data.values.shinyPortrait,hueRotate:0,portraitFallback:!0}:{value:this.data.values.normalPortrait,hueRotate:e?this.customization.shinyHue:0,portraitFallback:!0}}hasAnyMedia(){return Object.values(this.data.values).some(e=>e!=null)}get customization(){return this.data.customization??{shinyHue:0}}static forEachType(e){return new h({values:h.types.reduce((i,s)=>({...i,[s]:e(s)}),{})})}};l(h,"types",["normalPortrait","normalSprite","shinyPortrait","shinySprite"]),l(h,"attributionTypes",[{name:"Human Drawn",value:"human"},{name:"AI Generated",value:"ai"},{name:"Other",value:"other"}]);let d=h;class te extends c{}class f extends c{get id(){return new u(this.data.id)}get type(){return new O(this.data.type)}get gender(){return new W(this.data.gender)}get sr(){return new J(this.data.sr)}get eggGroups(){return new Q(this.data.eggGroups)}get hitDice(){return new j(this.data.hitDice)}get speed(){return new P(this.data.speed)}get senses(){return new w(this.data.senses)}get attributes(){return new V(this.data.attributes)}get skills(){return new T(this.data.skills)}get media(){return new d(this.data.media)}get moves(){return new te(this.data.moves)}get abilities(){return new y(this.data.abilities)}numberAsString(){return`#${this.data.number.toString().padStart(4,"0")}`}static fromJson(e){return new f({id:u.fromSpeciesName(e.id).data,name:e.name,number:e.number,type:e.type,size:e.size,sr:e.sr,minLevel:e.minLevel,eggGroups:e.eggGroup,gender:e.gender,description:e.description,ac:e.ac,hp:e.hp,hitDice:e.hitDice,speed:v.fromList(P,e.speed).data,senses:v.fromList(w,e.senses).data,attributes:e.attributes,skills:T.fromList(e.skills).data,saves:e.savingThrows,abilities:y.fromList(e.abilities).data,moves:e.moves,media:{values:{normalPortrait:{name:e.media.main,href:e.media.main},normalSprite:e.media.sprite?{name:e.media.sprite,href:e.media.sprite}:void 0,shinyPortrait:e.media.mainShiny?{name:e.media.mainShiny,href:e.media.mainShiny}:void 0,shinySprite:e.media.spriteShiny?{name:e.media.spriteShiny,href:e.media.spriteShiny}:void 0},customization:{shinyHue:0},attribution:e.media.attribution?{href:e.media.attribution}:void 0},evolution:e.evolution})}}class ie{constructor(e,i){l(this,"info",async(e,i)=>{try{if(i.media!=null){const s=await this.provider.updateMedia(e.data.writeKey,i.media);d.types.forEach(a=>{var r,n;((r=i.media.data.values[a])==null?void 0:r.type)==="remove"?e.data.species.media.values[a]=void 0:((n=i.media.data.values[a])==null?void 0:n.type)==="new"&&(e.data.species.media.values[a]=s.data.values[a])})}await this.provider.update(e),this.fakemonStore.update(s=>({...s,[e.data.readKey]:{value:e,update:this}}))}catch(s){throw Y.show(s.message),s}});this.provider=e,this.fakemonStore=i}}class se{constructor(e){l(this,"upload",async(e,i)=>{const s=await fetch(e,{method:"PUT",body:i,headers:{"Content-Type":i.type,"Content-Length":i.size.toString()}});if(!s.ok)throw console.error(await s.text()),new ae("Could not upload file.")});this.baseUrl=e}getAssetUrl(e){return`${this.baseUrl}/${e}`}}class ae extends Error{constructor(e,i){super(e+(i!=null&&i.code?` Code: ${i.code}`:"")),this.diagnostics=i}}const re=new se(X);class m extends Error{constructor(e){super(e)}}class ne extends m{constructor(){super("You do not have permission to edit this pokemon.")}}class b extends c{get species(){return new f(this.data.species)}}l(b,"alphabetical",(e,i)=>e.data.species.name.localeCompare(i.data.species.name));const $="fakemon::",E=t=>`${$}${t}`;function R(t){const e=E(t),i=localStorage.getItem(e);if(i!=null)try{return{...JSON.parse(i),readKey:t}}catch(s){console.warn(s);return}}function oe(t){const e=R(t.readKey),i=E(t.readKey);localStorage.setItem(i,JSON.stringify({id:t.id??(e==null?void 0:e.id),writeKey:t.writeKey??(e==null?void 0:e.writeKey)}))}function le(){const t=[];for(let e=0;e<localStorage.length;++e){const i=localStorage.key(e);if(!i.startsWith($))continue;const s=R(i.split("::")[1]);s!=null&&t.push(s)}return t}function de(t){const e=E(t);localStorage.removeItem(e)}const p={get:R,add:oe,list:le,remove:de};class ue{constructor(e,i){l(this,"handleNewMedia",async(e,i)=>{var r;const{data:s,error:a}=await this.supabase.functions.invoke("user-assets",{method:"POST",body:{type:"fakemon-media",params:{key:e,...(r=d.forEachType(n=>{var o;return((o=i.data.values[n])==null?void 0:o.type)==="new"?{mimetype:i.data.values[n].value.type,sizeInBytes:i.data.values[n].value.size}:void 0}))==null?void 0:r.data.values}}});if(a)throw new m("Could not upload file(s) for fakemon.");return await Promise.all(d.types.map(n=>{var o;return s.values[n]!=null&&((o=i.data.values[n])==null?void 0:o.type)==="new"?this.userAssets.upload(s.values[n].uploadUrl,i.data.values[n].value):void 0}).filter(n=>n!=null)),d.forEachType(n=>{var o;return s.values[n]!=null&&((o=i.data.values[n])==null?void 0:o.type)==="new"?this.getUserAssetResource(s.values[n].filename):void 0})});l(this,"handleRemovedMedia",async(e,i)=>{const{error:s}=await this.supabase.functions.invoke("user-assets",{method:"DELETE",body:{type:"fakemon-media",params:{key:e,...d.forEachType(a=>{var r;return((r=i.data.values[a])==null?void 0:r.type)==="remove"}).data.values}}});if(s)throw new m("Could not remove file(s) for fakemon.")});l(this,"getUserAssetResource",e=>({name:e,href:this.userAssets.getAssetUrl(e)}));this.supabase=e,this.userAssets=i}async getAllKnown(){return Promise.all(p.list().map(e=>this.getByReadKey(e.readKey))).then(e=>e.filter(i=>i!=null))}async getByReadKey(e){return this.supabase.rpc("get_fakemon",{_read_key:e}).maybeSingle().then(({data:i,error:s})=>{if(this.validateError("Could not get fakemon.",s),!i)return;const a=pe(i,this.getUserAssetResource),r=p.get(e);return a.data.writeKey=r==null?void 0:r.writeKey,p.add(a.data),a})}async add(e){const{data:i,error:s}=await this.supabase.rpc("new_fakemon",this.toQuery(e)).single();this.validateError("Could not add fakemon.",s);const a={id:i.ret_id,readKey:i.ret_read_key,writeKey:i.ret_write_key};return p.add(a),new b({species:{...e,id:u.fromFakemonReadKey(a.readKey).data},...a})}async update(e){const i=e.data.writeKey;if(i==null)throw new ne;const{data:s,error:a}=await this.supabase.rpc("update_fakemon",{_write_key:i,...this.toQuery(e.data.species)}).single();return this.validateError("Could not edit fakemon.",a),s>0}async updateMedia(e,i){const[s]=await Promise.all([this.handleNewMedia(e,i),this.handleRemovedMedia(e,i)]);return s}async verifyWriteKey(e,i){const{data:s,error:a}=await this.supabase.rpc("verify_fakemon_write_key",{_id:e.data.id,_write_key:i}).single();if(a)throw new m("Could not verify fakemon.");return s>0&&p.add({id:e.data.id,readKey:e.data.readKey,writeKey:i}),s>0}validateError(e,i){if(i)throw console.error(i),new m(e)}toQuery(e){var i,s,a,r,n,o,C,x,A,L,z,k,F;return{_species_name:e.name,_type:e.type,_size:e.size,_sr:e.sr,_min_level:e.minLevel,_egg_groups:e.eggGroups,_gender:e.gender,_description:e.description,_ac:e.ac,_hp:e.hp,_hit_dice:e.hitDice,_speed_walking:e.speed.walking??0,_speed_climbing:e.speed.climbing??0,_speed_swimming:e.speed.swimming??0,_speed_flying:e.speed.flying??0,_speed_hover:e.speed.hover??0,_speed_burrowing:e.speed.burrowing??0,_sense_darkvision:e.senses.darkvision??0,_sense_blindsight:e.senses.blindsight??0,_sense_tremorsense:e.senses.tremorsense??0,_sense_truesight:e.senses.truesight??0,_strength:e.attributes.str,_dexterity:e.attributes.dex,_constitution:e.attributes.con,_intelligence:e.attributes.int,_wisdom:e.attributes.wis,_charisma:e.attributes.cha,_prof_athletics:e.skills.athletics>0,_prof_acrobatics:e.skills.acrobatics>0,_prof_sleight_of_hand:e.skills["sleight of hand"]>0,_prof_stealth:e.skills.stealth>0,_prof_arcana:e.skills.arcana>0,_prof_history:e.skills.history>0,_prof_investigation:e.skills.investigation>0,_prof_nature:e.skills.nature>0,_prof_religion:e.skills["religion fakemon"]>0,_prof_animal_handling:e.skills["animal handling"]>0,_prof_insight:e.skills.insight>0,_prof_medicine:e.skills.medicine>0,_prof_perception:e.skills.perception>0,_prof_survival:e.skills.survival>0,_prof_deception:e.skills.deception>0,_prof_intimidation:e.skills.intimidation>0,_prof_performance:e.skills.performance>0,_prof_persuasion:e.skills.persuasion>0,_save_str:e.saves.includes("str"),_save_dex:e.saves.includes("dex"),_save_con:e.saves.includes("con"),_save_int:e.saves.includes("int"),_save_wis:e.saves.includes("wis"),_save_cha:e.saves.includes("cha"),_abilities:e.abilities.normal,_hidden_abilities:e.abilities.hidden,_moves_start:e.moves.start,_moves_level2:e.moves.level2,_moves_level6:e.moves.level6,_moves_level10:e.moves.level10,_moves_level14:e.moves.level14,_moves_level18:e.moves.level18,_moves_egg:e.moves.egg,_moves_tm:e.moves.tm,_art_attribution_type:((s=(i=e.media.attribution)==null?void 0:i.portrait)==null?void 0:s.type)??null,_art_attribution_name:((r=(a=e.media.attribution)==null?void 0:a.portrait)==null?void 0:r.name)??null,_art_attribution_href:((o=(n=e.media.attribution)==null?void 0:n.portrait)==null?void 0:o.href)??null,_sprite_attribution_type:((x=(C=e.media.attribution)==null?void 0:C.sprite)==null?void 0:x.type)??null,_sprite_attribution_name:((L=(A=e.media.attribution)==null?void 0:A.sprite)==null?void 0:L.name)??null,_sprite_attribution_href:((k=(z=e.media.attribution)==null?void 0:z.sprite)==null?void 0:k.href)??null,_shiny_hue_rotation:((F=e.media.customization)==null?void 0:F.shinyHue)??0}}}const ce=t=>Object.entries(t).filter(([,e])=>e).map(([e])=>e);function pe(t,e){return new b({id:t.id,readKey:t.read_key,writeKey:t.write_key,species:{id:u.fromFakemonReadKey(t.read_key).data,name:t.species_name,type:t.type.filter(O.isPokeType),number:0,size:ee(t.size)?t.size:"small",sr:parseFloat(t.sr),minLevel:t.min_level,eggGroups:t.egg_groups,gender:t.gender,description:t.description,ac:t.ac,hp:t.hp,hitDice:j.isHitDice(t.hit_dice)?t.hit_dice:"d6",speed:{walking:t.speed_walking,swimming:t.speed_swimming,climbing:t.speed_climbing,flying:t.speed_flying,hover:t.speed_hover,burrowing:t.speed_burrowing},senses:{darkvision:t.sense_darkvision,blindsight:t.sense_blindsight,tremorsense:t.sense_tremorsense,truesight:t.sense_truesight},attributes:{str:t.strength,dex:t.dexterity,con:t.constitution,int:t.intelligence,wis:t.wisdom,cha:t.charisma},skills:{athletics:t.prof_athletics?1:0,acrobatics:t.prof_acrobatics?1:0,"sleight of hand":t.prof_sleight_of_hand?1:0,stealth:t.prof_stealth?1:0,arcana:t.prof_arcana?1:0,history:t.prof_history?1:0,investigation:t.prof_investigation?1:0,nature:t.prof_nature?1:0,religion:t.prof_religion?1:0,"animal handling":t.prof_animal_handling?1:0,insight:t.prof_insight?1:0,medicine:t.prof_medicine?1:0,perception:t.prof_perception?1:0,survival:t.prof_survival?1:0,deception:t.prof_deception?1:0,intimidation:t.prof_intimidation?1:0,performance:t.prof_performance?1:0,persuasion:t.prof_persuasion?1:0},saves:ce({str:t.save_str,dex:t.save_dex,con:t.save_con,int:t.save_int,wis:t.save_wis,cha:t.save_cha}),abilities:{normal:t.abilities,hidden:t.hidden_abilities},moves:{start:t.moves_start,level2:t.moves_level2,level6:t.moves_level6,level10:t.moves_level10,level14:t.moves_level14,level18:t.moves_level18,egg:t.moves_egg,tm:t.moves_tm},media:{values:{normalPortrait:t.normal_portrait_filename?e(t.normal_portrait_filename):void 0,normalSprite:t.normal_sprite_filename?e(t.normal_sprite_filename):void 0,shinyPortrait:t.shiny_portrait_filename?e(t.shiny_portrait_filename):void 0,shinySprite:t.shiny_sprite_filename?e(t.shiny_sprite_filename):void 0},customization:{shinyHue:t.shiny_hue_rotation},attribution:{portrait:{type:t.art_attribution_type??"",name:t.art_attribution_name??"",href:t.art_attribution_href??""},sprite:{type:t.sprite_attribution_type??"",name:t.sprite_attribution_name??"",href:t.sprite_attribution_href??""}}}}})}const _=new ue(q,re);function g(t,e){return{value:t,update:t.data.writeKey!=null?new ie(_,e):void 0}}function D(t,e){return{subscribe:i=>e.subscribe(s=>{i(s[t.value.data.readKey]??t)}),verifyAccess:async i=>{const s=await _.verifyWriteKey(t.value,i);return s&&e.update(a=>({...a,[t.value.data.readKey]:g(t.value.copy({writeKey:i}),e)})),s},remove:async()=>{e.update(i=>{const{[t.value.data.readKey]:s,...a}=i;return a}),p.remove(t.value.data.readKey)}}}function he(t,e){let i=!1;return{subscribe:s=>e.subscribe(a=>{s(Object.values(a).map(r=>r.value).sort(b.alphabetical)),i||(i=!0,e.update(r=>t.reduce((n,o)=>({...n,[o.data.readKey]:g(o,e)}),r)))})}}function me(){const t=G({}),e={};let i;return{get:async s=>(e[s]==null&&(e[s]=_.getByReadKey(s).then(a=>{if(a==null)return;const r=g(a,t);return t.update(n=>({...n,[a.data.readKey]:r})),D(r,t)})),e[s]),new:async s=>_.add(s).then(a=>{const r=g(a,t),n=D(r,t);return e[a.data.readKey]=Promise.resolve(n),t.update(o=>({...o,[a.data.readKey]:r})),a}),all:async()=>(i==null&&(i=_.getAllKnown().then(s=>he(s,t))),i),reset:async()=>{t.set({})}}}const U=me(),K=H(void 0,t=>{typeof window<"u"&&fetch(`${B}/pokemon.json`).then(e=>e.json()).then(e=>e.items.map(i=>f.fromJson(i))).then(e=>t(e))});function _e(){return{get:async t=>{if(t.isFakemon()){const e=await U.get(t.toFakemonReadKey());return e==null?void 0:S(e,i=>({value:i.value.species}))}else return S(K,e=>{const i=e==null?void 0:e.find(s=>s.id.data===t.data);if(i!=null)return{value:i}})},canonList:()=>K,completeList:async()=>{const t=await U.all();return S([K,t],([e,i])=>e==null?void 0:e.concat(i.map(s=>s.species)))}}}const Me=_e(),I="canCreateCustomPokemonBannerVisibility",ve=localStorage.getItem(I)==="true",ye=G(ve);ye.subscribe(t=>localStorage.setItem(I,t.toString()));export{ye as C,b as F,f as P,Me as S,Ie as a,P as b,w as c,u as d,d as e,U as f,Z as g,ee as i,re as u};
