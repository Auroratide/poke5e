var G=Object.defineProperty;var V=(t,s,e)=>s in t?G(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var l=(t,s,e)=>V(t,typeof s!="symbol"?s+"":s,e);import{d as Y,w as Z}from"./C8BBpXQ9.js";import"./j7n1n7oY.js";import{Z as E}from"./B-p2TLsN.js";import"./BxlXVsHr.js";import"./BWIuQawj.js";import{r as J}from"./D585_UzU.js";import{c as O,d as R,e as H,f as U,H as K,g as Q,i as X,u as ee}from"./BuShfGvS.js";import{P as N}from"./DLn0St_8.js";import{D as W}from"./Bf-g66YD.js";import"./CdRAs_Ty.js";import{P as D}from"./ATOTVc99.js";import"./CCALAQ7Y.js";/* empty css        */import{s as te,e as k}from"./DKQKXGdo.js";import"./otaaOoX9.js";import{e as ae}from"./CiCBzg5j.js";import{L as C}from"./C2DumLO3.js";import{b as ie,c as se}from"./fiTa_PwR.js";const ne="stellar",F=class F extends W{};l(F,"list",[].concat(N.list).concat(ne)),l(F,"isTeraType",s=>F.list.includes(s));let S=F;const P=()=>{var t,s;return((s=(t=localStorage.getItem("trainers"))==null?void 0:t.split(","))==null?void 0:s.filter(e=>e!==""))??[]},re=t=>{const s=P(),e=[...new Set(s.concat(t))];localStorage.setItem("trainers",e.join(","))},ce=t=>{const e=P().filter(a=>a!==t);localStorage.setItem("trainers",e.join(","))},oe=t=>P().find(s=>M(s)===t),M=t=>localStorage.getItem(`write:${t}`),_e=(t,s)=>{localStorage.setItem(`write:${t}`,s)},de=t=>{localStorage.removeItem(`write:${t}`)},b={getReadKeys:P,addReadKey:re,removeReadKey:ce,getReadKey:oe,getWriteKey:M,addWriteKey:_e,removeWriteKey:de};function pe(){return{name:"",resource:0,customFeatures:{level2:{description:""},level5:{name:"",description:""},level9:{name:"",description:""},level15:{name:"",description:""}}}}const $=Y(J,t=>t==="2018"?ie:se);class q extends W{isStandard(){return E($).includes(this.data)}}const A="trainer_avatars";class le{constructor(s,e){l(this,"allTrainers",async()=>Promise.all(b.getReadKeys().map(s=>this.getOneTrainerInfo(s))).then(s=>s.filter(e=>e!=null)));l(this,"getTrainer",async s=>{const e=await this.getOneTrainerInfo(s);if(!e)return;b.addReadKey(s);const a=await this.getTrainersPokemon(e.id),i=b.getWriteKey(s);return{info:e,pokemon:a,writeKey:i}});l(this,"getOneTrainerInfo",async s=>{const e=await this.supabase.rpc("get_trainer",{_read_key:s}).maybeSingle().then(({data:h,error:c})=>{if(c)throw new m("Could not get trainer.",c);if(h)return ue(h,this.getStorageResource)});if(e==null)return;const[a,i]=await Promise.all([this.getTrainerInventory(e.readKey),this.getTrainerFeats(e.readKey)]);return e.inventory=a,e.feats=i,e});l(this,"getTrainersPokemon",async s=>await this.supabase.rpc("get_pokemon",{_trainer_id:s}).select().then(({data:e,error:a})=>{if(a)throw new m("Could not trainer's pokemon.",a);return e.map(i=>he(i,this.getUserAssetResource))}).then(e=>Promise.all(e.map(a=>this.getMoveset(a.id).then(i=>({...a,moves:i}))))).then(e=>Promise.all(e.map(a=>this.getHeldItems(a.id).then(i=>({...a,items:i}))))).then(e=>Promise.all(e.map(a=>this.getPokemonFeats(a.id).then(i=>({...a,feats:i}))))));l(this,"newTrainer",async s=>{const e={...s,level:new C(1),ac:10,hp:{current:8,max:8},hitDice:{current:1,max:1},attributes:new R({str:10,dex:10,con:10,int:10,wis:10,cha:10}),proficiencies:new O({athletics:0,acrobatics:0,"sleight of hand":0,stealth:0,arcana:0,history:0,investigation:0,nature:0,religion:0,"animal handling":1,insight:0,medicine:0,perception:0,survival:0,deception:0,intimidation:0,performance:0,persuasion:0}),savingThrows:["cha"],biography:{species:"Human",gender:null,age:null,homeRegion:null,background:null},money:0,inventory:[],specializations:{ghost:0,fairy:0,normal:0,fighting:0,flying:0,poison:0,fire:0,grass:0,water:0,electric:0,psychic:0,dark:0,bug:0,ice:0,dragon:0,steel:0,rock:0,ground:0},path:pe(),feats:[]},{data:a,error:i}=await this.supabase.rpc("new_trainer",{_name:e.name,_description:e.description,_level:e.level.data,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_species:e.biography.species,_gender:e.biography.gender,_age:e.biography.age,_home_region:e.biography.homeRegion,_background:e.biography.background,_money:e.money,_special_normal:e.specializations.normal??0,_special_fighting:e.specializations.fighting??0,_special_flying:e.specializations.flying??0,_special_poison:e.specializations.poison??0,_special_ground:e.specializations.ground??0,_special_rock:e.specializations.rock??0,_special_bug:e.specializations.bug??0,_special_ghost:e.specializations.ghost??0,_special_steel:e.specializations.steel??0,_special_fire:e.specializations.fire??0,_special_water:e.specializations.water??0,_special_grass:e.specializations.grass??0,_special_electric:e.specializations.electric??0,_special_psychic:e.specializations.psychic??0,_special_ice:e.specializations.ice??0,_special_dragon:e.specializations.dragon??0,_special_dark:e.specializations.dark??0,_special_fairy:e.specializations.fairy??0,_path_name:e.path.name,_path_resource:e.path.resource,_path_rank_1_name:"",_path_rank_1_desc:e.path.customFeatures.level2.description,_path_rank_2_name:e.path.customFeatures.level5.name,_path_rank_2_desc:e.path.customFeatures.level5.description,_path_rank_3_name:e.path.customFeatures.level9.name,_path_rank_3_desc:e.path.customFeatures.level9.description,_path_rank_4_name:e.path.customFeatures.level15.name,_path_rank_4_desc:e.path.customFeatures.level15.description}).single();if(i)throw new m("Could not create trainer.",i);return b.addReadKey(a.ret_read_key),b.addWriteKey(a.ret_read_key,a.ret_write_key),{info:{...e,id:a.ret_id,readKey:a.ret_read_key},pokemon:[],writeKey:a.ret_write_key}});l(this,"updateTrainerInfo",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("update_trainer",{_write_key:s,_name:e.name,_description:e.description,_level:e.level.data,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_species:e.biography.species,_gender:e.biography.gender,_age:e.biography.age,_home_region:e.biography.homeRegion,_background:e.biography.background,_money:e.money,_special_normal:e.specializations.normal??0,_special_fighting:e.specializations.fighting??0,_special_flying:e.specializations.flying??0,_special_poison:e.specializations.poison??0,_special_ground:e.specializations.ground??0,_special_rock:e.specializations.rock??0,_special_bug:e.specializations.bug??0,_special_ghost:e.specializations.ghost??0,_special_steel:e.specializations.steel??0,_special_fire:e.specializations.fire??0,_special_water:e.specializations.water??0,_special_grass:e.specializations.grass??0,_special_electric:e.specializations.electric??0,_special_psychic:e.specializations.psychic??0,_special_ice:e.specializations.ice??0,_special_dragon:e.specializations.dragon??0,_special_dark:e.specializations.dark??0,_special_fairy:e.specializations.fairy??0,_path_name:e.path.name,_path_resource:e.path.resource,_path_rank_1_name:"",_path_rank_1_desc:e.path.customFeatures.level2.description,_path_rank_2_name:e.path.customFeatures.level5.name,_path_rank_2_desc:e.path.customFeatures.level5.description,_path_rank_3_name:e.path.customFeatures.level9.name,_path_rank_3_desc:e.path.customFeatures.level9.description,_path_rank_4_name:e.path.customFeatures.level15.name,_path_rank_4_desc:e.path.customFeatures.level15.description}).single();if(i)throw new m("Could not update trainer.",i);if(a<=0)throw new m("Either this trainer does not exist or you do not have permission to edit them.");return a>0});l(this,"updateTrainerAvatar",async(s,e,a)=>{const i=await this.generateTrainerAvatarFilename(s,e),{error:h}=await this.supabase.storage.from(A).upload(i,e);if(h)throw new m("Could not upload file for trainer.");return await this.removeOldTrainerAvatar(a),this.getStorageResource(A,i)});l(this,"removeTrainerAvatar",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("remove_trainer_avatar",{_write_key:s}).single();if(a!=null&&a<=0)throw new m("You do not have permission to edit this trainer.");if(i)throw new m("Could not remove trainer's avatar image",i);await this.removeOldTrainerAvatar(e)});l(this,"generateTrainerAvatarFilename",async(s,e)=>{const a=e.name.split(".").at(-1),{data:i,error:h}=await this.supabase.rpc("new_trainer_avatar_filename",{_write_key:s,_extension:"."+a}).single();if(h)throw new m("Could not generate filename for trainer avatar.",h);return i});l(this,"removeOldTrainerAvatar",async s=>{if(s!=null){const{error:e}=await this.supabase.storage.from(A).remove([s.name]);e&&console.warn("Could not remove old trainer avatar. Ignoring this error.")}});l(this,"removeTrainer",async(s,e)=>{b.removeWriteKey(e),b.removeReadKey(e)});l(this,"deleteTrainer",async(s,e,a)=>{const{data:i,error:h}=await this.supabase.rpc("delete_trainer",{_write_key:s,_id:e}).single();if(h)throw new m("Could not delete trainer.",h);if(i<=0)throw new m("Either this trainer does not exist or you do not have permission to edit them.");return b.removeWriteKey(a),b.removeReadKey(a),i>0});l(this,"updatePokemon",async(s,e)=>{var h;const{data:a,error:i}=await this.supabase.rpc("update_pokemon",{_write_key:s,_id:parseInt(e.id),_species:e.pokemonId.data,_nickname:e.nickname,_type:e.type.data,_nature:e.nature.data,_level:e.level.data,_gender:e.gender,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_ability:e.ability??"",_notes:e.notes,_tera_type:e.teraType.data,_exp:e.exp,_status:e.status,_held_item:null,_is_shiny:e.isShiny,_custom_size:e.customSize??null,_hit_dice_size:((h=e.customHitDiceSize)==null?void 0:h.data)??null,_speed_walking:e.speeds.data.walking??null,_speed_climbing:e.speeds.data.climbing??null,_speed_swimming:e.speeds.data.swimming??null,_speed_flying:e.speeds.data.flying??null,_speed_hover:e.speeds.data.hover??null,_speed_burrowing:e.speeds.data.burrowing??null,_sense_darkvision:e.senses.data.darkvision??null,_sense_blindsight:e.senses.data.blindsight??null,_sense_tremorsense:e.senses.data.tremorsense??null,_sense_truesight:e.senses.data.truesight??null,_bond_level:e.bond.level,_bond_points_cur:e.bond.points.current,_bond_points_max:e.bond.points.max}).single();if(i)throw new m("Could not update pokemon.",i);if(a<=0)throw new m("Either this pokemon does not exist or you do not have permission to edit them.");return a>0});l(this,"updatePokemonAvatar",async(s,e,a)=>{const{data:i,error:h}=await this.supabase.functions.invoke("user-assets",{method:"POST",body:{type:"pokemon-avatar",params:{id:e.id,key:s,mimetype:a.type,sizeInBytes:a.size}}});if(h)throw new m("Could not upload file for pokemon.");return await this.userAssets.upload(i.values.uploadUrl,a),this.getUserAssetResource(i.values.filename)});l(this,"removePokemonAvatar",async(s,e)=>{const{error:a}=await this.supabase.functions.invoke("user-assets",{method:"DELETE",body:{type:"pokemon-avatar",params:{id:e.id,key:s}}});if(a)throw console.error(a),new m("Could not delete file for pokemon.")});l(this,"addPokemonToTeam",async(s,e,a)=>{var g,y;const i={trainerId:e,pokemonId:a.id,nickname:a.data.name,type:a.type,nature:new q(E($)[0]),level:new C(a.data.minLevel),exp:ae(a.data.minLevel),gender:D.None,attributes:a.attributes,ac:a.data.ac,ability:(g=a.abilities.toList()[0])==null?void 0:g.id,hp:{current:a.data.hp,max:a.data.hp},hitDice:{current:a.data.minLevel,max:a.data.minLevel},proficiencies:a.skills.copy(),savingThrows:a.data.saves,moves:[],items:[],notes:a.data.notes??"",teraType:new S(a.type.primary),status:null,isShiny:!1,feats:[],customSize:void 0,customHitDiceSize:void 0,speeds:new U({}),senses:new H({}),bond:{level:0,points:{current:0,max:0}}},{data:h,error:c}=await this.supabase.rpc("add_pokemon",{_write_key:s,_nickname:a.data.name,_species:a.id.data,_nature:i.nature.data,_type:a.type.data,_level:a.data.minLevel,_gender:D.None,_strength:a.attributes.str.score,_dexterity:a.attributes.dex.score,_constitution:a.attributes.con.score,_intelligence:a.attributes.int.score,_wisdom:a.attributes.wis.score,_charisma:a.attributes.cha.score,_ac:a.data.ac,_hp_cur:a.data.hp,_hp_max:a.data.hp,_hit_dice_cur:a.data.minLevel,_hit_dice_max:a.data.minLevel,_rank_athletics:i.proficiencies.data.athletics,_rank_acrobatics:i.proficiencies.data.acrobatics,_rank_sleight_of_hand:i.proficiencies.data["sleight of hand"],_rank_stealth:i.proficiencies.data.stealth,_rank_arcana:i.proficiencies.data.arcana,_rank_history:i.proficiencies.data.history,_rank_investigation:i.proficiencies.data.investigation,_rank_nature:i.proficiencies.data.nature,_rank_religion:i.proficiencies.data.religion,_rank_animal_handling:i.proficiencies.data["animal handling"],_rank_insight:i.proficiencies.data.insight,_rank_medicine:i.proficiencies.data.medicine,_rank_perception:i.proficiencies.data.perception,_rank_survival:i.proficiencies.data.survival,_rank_deception:i.proficiencies.data.deception,_rank_intimidation:i.proficiencies.data.intimidation,_rank_performance:i.proficiencies.data.performance,_rank_persuasion:i.proficiencies.data.persuasion,_save_str:a.data.saves.includes("str"),_save_dex:a.data.saves.includes("dex"),_save_con:a.data.saves.includes("con"),_save_int:a.data.saves.includes("int"),_save_wis:a.data.saves.includes("wis"),_save_cha:a.data.saves.includes("cha"),_ability:((y=a.abilities.toList()[0])==null?void 0:y.id)??"",_notes:i.notes??"",_tera_type:a.type.primary,_exp:i.exp,_status:null,_held_item:null,_is_shiny:!1,_custom_size:null,_hit_dice_size:null,_speed_walking:null,_speed_climbing:null,_speed_swimming:null,_speed_flying:null,_speed_hover:null,_speed_burrowing:null,_sense_darkvision:null,_sense_blindsight:null,_sense_tremorsense:null,_sense_truesight:null,_bond_level:0,_bond_points_cur:0,_bond_points_max:0}).single();if(c)throw new m("Could not add pokemon.",c);return{...i,id:h.toString()}});l(this,"removePokemon",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("remove_pokemon",{_write_key:s,_id:e}).single();if(i)throw new m("Could not remove pokemon.",i);return a>0});l(this,"updateListOfThings",async({thingName:s,writeKey:e,newThings:a,getExistingThings:i,removeFunctionName:h,updateFunctionName:c,addFunctionName:g,mapThingToDbArgument:y})=>{const T=await i(),w=a.map(n=>n.id),I=T.map(n=>n.id),d=I.filter(n=>!w.includes(n));return await Promise.all(d.map(n=>this.supabase.rpc(h,{_write_key:e,_id:n}).single().then(({data:r,error:_})=>{if(_)throw new m(`Could not delete ${s}.`,_);if(r<=0)throw new m("Either this trainer/pokemon does not exist or you do not have permission to edit them.");return r>0}))),await Promise.all(a.map((n,r)=>I.includes(n.id)?this.supabase.rpc(c,y(n,r,"update")).single().then(({data:_,error:p})=>{if(p)throw new m(`Could not update ${s}.`,p);if(_<=0)throw new m("Either this trainer/pokemon does not exist or you do not have permission to edit them.");return{...n}}):this.supabase.rpc(g,y(n,r,"add")).single().then(({data:_,error:p})=>{if(p)throw new m(`Could not add ${s}.`,p);return{...n,id:_}})))});l(this,"updateMoveset",async(s,e,a)=>this.updateListOfThings({thingName:"move",writeKey:s,newThings:a,getExistingThings:()=>this.getMoveset(e),removeFunctionName:"remove_move",updateFunctionName:"update_move",addFunctionName:"add_move",mapThingToDbArgument:(i,h,c)=>({_write_key:s,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?i.id:void 0,_move_id:i.moveId,_pp_cur:i.pp.current,_pp_max:i.pp.max,_notes:i.notes,_rank:h})}));l(this,"updateOneMove",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("update_move",{_write_key:s,_id:e.id,_move_id:e.moveId,_pp_cur:e.pp.current,_pp_max:e.pp.max,_notes:e.notes}).single();if(i)throw new m("Could not update pokemon.",i);if(a<=0)throw new m("Either this pokemon does not exist or you do not have permission to edit them.");return a>0});l(this,"updateAllHeldItems",async(s,e,a)=>this.updateListOfThings({thingName:"held item",writeKey:s,newThings:a,getExistingThings:()=>this.getHeldItems(e),removeFunctionName:"remove_held_item",updateFunctionName:"update_held_item",addFunctionName:"add_held_item",mapThingToDbArgument:(i,h,c)=>({_write_key:s,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?i.id:void 0,_item_id:i.type==="standard"?i.itemId:null,_custom_name:i.type==="custom"?i.name:null,_description:i.type==="custom"?i.description:null,_rank:h})}));l(this,"updateTrainerInventory",async(s,e)=>this.updateListOfThings({thingName:"inventory item",writeKey:s,newThings:e,getExistingThings:()=>this.getTrainerInventory(b.getReadKey(s)),removeFunctionName:"remove_inventory_item",updateFunctionName:"update_inventory_item",addFunctionName:"add_inventory_item",mapThingToDbArgument:(a,i,h)=>({_write_key:s,_id:h==="update"?a.id:void 0,_item_id:a.type==="standard"?a.itemId:null,_quantity:a.quantity,_custom_name:a.type==="custom"?a.name:null,_description:a.type==="custom"?a.description:null,_rank:i})}));l(this,"updateTrainerFeats",async(s,e)=>this.updateListOfThings({thingName:"feat",writeKey:s,newThings:e,getExistingThings:()=>this.getTrainerFeats(b.getReadKey(s)),removeFunctionName:"remove_trainer_feat",updateFunctionName:"update_trainer_feat",addFunctionName:"add_trainer_feat",mapThingToDbArgument:(a,i,h)=>({_write_key:s,_id:h==="update"?a.id:void 0,_feat_name:a.name,_description:a.description,_is_custom:a.isCustom,_rank:i})}));l(this,"updatePokemonFeats",async(s,e,a)=>this.updateListOfThings({thingName:"feat",writeKey:s,newThings:a,getExistingThings:()=>this.getPokemonFeats(e),removeFunctionName:"remove_pokemon_feat",updateFunctionName:"update_pokemon_feat",addFunctionName:"add_pokemon_feat",mapThingToDbArgument:(i,h,c)=>({_write_key:s,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?i.id:void 0,_feat_name:i.name,_description:i.description,_is_custom:i.isCustom,_rank:h})}));l(this,"updateTrainerItem",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("update_inventory_item",{_write_key:s,_id:e.id,_item_id:e.type==="standard"?e.itemId:null,_quantity:e.quantity,_custom_name:e.type==="custom"?e.name:null,_description:e.type==="custom"?e.description:null}).single();if(i)throw new m("Could not update inventory item.",i);if(a<=0)throw new m("Either this trainer does not exist or you do not have permission to edit them.");return a>0});l(this,"verifyWriteKey",async(s,e)=>{const{data:a,error:i}=await this.supabase.rpc("verify_write_key",{_id:s.id,_write_key:e}).single();if(i)throw new m("Could not verify trainer.",i);return a>0&&b.addWriteKey(s.readKey,e),a>0});l(this,"getMoveset",async s=>{const{data:e,error:a}=await this.supabase.rpc("get_moveset",{_pokemon_id:s}).select();if(a)throw new m("Could not get moveset.",a);return(e==null?void 0:e.map(i=>me(i)))??[]});l(this,"getHeldItems",async s=>{const{data:e,error:a}=await this.supabase.rpc("get_held_items",{_pokemon_id:s}).select();if(a)throw new m("Could not get held items.",a);return(e==null?void 0:e.map(i=>ge(i)))??[]});l(this,"getTrainerInventory",async s=>{const{data:e,error:a}=await this.supabase.rpc("get_inventory_items",{_read_key:s}).select();if(a)throw new m("Could not get inventory items.",a);return(e==null?void 0:e.map(i=>ve(i)))??[]});l(this,"getTrainerFeats",async s=>{const{data:e,error:a}=await this.supabase.rpc("get_trainer_feats",{_read_key:s}).select();if(a)throw new m("Could not get trainer feats.",a);return(e==null?void 0:e.map(i=>ke(i)))??[]});l(this,"getPokemonFeats",async s=>{const{data:e,error:a}=await this.supabase.rpc("get_pokemon_feats",{_pokemon_id:s}).select();if(a)throw new m("Could not get pokemon feats.",a);return(e==null?void 0:e.map(i=>ye(i)))??[]});l(this,"getStorageResource",(s,e)=>({name:e,href:this.supabase.storage.from(s).getPublicUrl(e).data.publicUrl}));l(this,"getUserAssetResource",s=>({name:s,href:this.userAssets.getAssetUrl(s)}));this.supabase=s,this.userAssets=e}}const ue=(t,s)=>({id:t.id,readKey:t.read_key,name:t.name,description:t.description,level:new C(t.level),attributes:new R({str:t.strength,dex:t.dexterity,con:t.constitution,int:t.intelligence,wis:t.wisdom,cha:t.charisma}),ac:t.ac,hp:{current:t.hp_cur,max:t.hp_max},hitDice:{current:t.hit_dice_cur,max:t.hit_dice_max},proficiencies:B({athletics:[t.prof_athletics,t.rank_athletics],acrobatics:[t.prof_acrobatics,t.rank_acrobatics],"sleight of hand":[t.prof_sleight_of_hand,t.rank_sleight_of_hand],stealth:[t.prof_stealth,t.rank_stealth],arcana:[t.prof_arcana,t.rank_arcana],history:[t.prof_history,t.rank_history],investigation:[t.prof_investigation,t.rank_investigation],nature:[t.prof_nature,t.rank_nature],religion:[t.prof_religion,t.rank_religion],"animal handling":[t.prof_animal_handling,t.rank_animal_handling],insight:[t.prof_insight,t.rank_insight],medicine:[t.prof_medicine,t.rank_medicine],perception:[t.prof_perception,t.rank_perception],survival:[t.prof_survival,t.rank_survival],deception:[t.prof_deception,t.rank_deception],intimidation:[t.prof_intimidation,t.rank_intimidation],performance:[t.prof_performance,t.rank_performance],persuasion:[t.prof_persuasion,t.rank_persuasion]}),savingThrows:j({str:t.save_str,dex:t.save_dex,con:t.save_con,int:t.save_int,wis:t.save_wis,cha:t.save_cha}),biography:{species:t.species,gender:t.gender,age:t.age,homeRegion:t.home_region,background:t.background},money:t.money,inventory:[],avatar:t.avatar_filename!=null?s(A,t.avatar_filename):null,specializations:{normal:t.special_normal,fighting:t.special_fighting,flying:t.special_flying,poison:t.special_poison,ground:t.special_ground,rock:t.special_rock,bug:t.special_bug,ghost:t.special_ghost,steel:t.special_steel,fire:t.special_fire,water:t.special_water,grass:t.special_grass,electric:t.special_electric,psychic:t.special_psychic,ice:t.special_ice,dragon:t.special_dragon,dark:t.special_dark,fairy:t.special_fairy},path:{name:t.path_name,resource:t.path_resource,customFeatures:{level2:{description:t.path_rank_1_desc},level5:{name:t.path_rank_2_name,description:t.path_rank_2_desc},level9:{name:t.path_rank_3_name,description:t.path_rank_3_desc},level15:{name:t.path_rank_4_name,description:t.path_rank_4_desc}}},feats:[]}),j=t=>Object.entries(t).filter(([,s])=>s).map(([s])=>s),B=t=>new O(Object.entries(t).reduce((s,[e,[a,i]])=>({...s,[e]:i>0?i:a?1:0}),{})),he=(t,s)=>({id:t.id.toString(),trainerId:t.trainer_id,pokemonId:new Q(t.species),nickname:t.nickname,type:new N(t.type.filter(N.isPokeType)),nature:new q(t.nature),level:new C(t.level),exp:t.exp,gender:t.gender,attributes:new R({str:t.strength,dex:t.dexterity,con:t.constitution,int:t.intelligence,wis:t.wisdom,cha:t.charisma}),ac:t.ac,hp:{current:t.hp_cur,max:t.hp_max},hitDice:{current:t.hit_dice_cur,max:t.hit_dice_max},ability:t.ability,proficiencies:B({athletics:[t.prof_athletics,t.rank_athletics],acrobatics:[t.prof_acrobatics,t.rank_acrobatics],"sleight of hand":[t.prof_sleight_of_hand,t.rank_sleight_of_hand],stealth:[t.prof_stealth,t.rank_stealth],arcana:[t.prof_arcana,t.rank_arcana],history:[t.prof_history,t.rank_history],investigation:[t.prof_investigation,t.rank_investigation],nature:[t.prof_nature,t.rank_nature],religion:[t.prof_religion,t.rank_religion],"animal handling":[t.prof_animal_handling,t.rank_animal_handling],insight:[t.prof_insight,t.rank_insight],medicine:[t.prof_medicine,t.rank_medicine],perception:[t.prof_perception,t.rank_perception],survival:[t.prof_survival,t.rank_survival],deception:[t.prof_deception,t.rank_deception],intimidation:[t.prof_intimidation,t.rank_intimidation],performance:[t.prof_performance,t.rank_performance],persuasion:[t.prof_persuasion,t.rank_persuasion]}),savingThrows:j({str:t.save_str,dex:t.save_dex,con:t.save_con,int:t.save_int,wis:t.save_wis,cha:t.save_cha}),moves:[],items:[],notes:t.notes,teraType:S.isTeraType(t.tera_type)?new S(t.tera_type):void 0,status:t.status,isShiny:t.is_shiny,feats:[],customSize:X(t.custom_size)?t.custom_size:void 0,customHitDiceSize:K.isHitDice(t.hit_dice_size)?new K(t.hit_dice_size):void 0,speeds:new U({walking:t.speed_walking,climbing:t.speed_climbing,swimming:t.speed_swimming,flying:t.speed_flying,hover:t.speed_hover,burrowing:t.speed_burrowing}),senses:new H({darkvision:t.sense_darkvision,blindsight:t.sense_blindsight,tremorsense:t.sense_tremorsense,truesight:t.sense_truesight}),bond:{level:t.bond_level,points:{current:t.bond_points_cur,max:t.bond_points_max}},avatar:t.avatar_filename?s(t.avatar_filename):void 0}),me=t=>({id:t.id.toString(),moveId:t.move_id,pp:{current:t.pp_cur,max:t.pp_max},notes:t.notes}),ge=t=>({id:t.id.toString(),type:t.item_id!=null?"standard":"custom",itemId:t.item_id,name:t.custom_name,description:t.description}),ve=t=>({id:t.id.toString(),type:t.item_id!=null?"standard":"custom",itemId:t.item_id,quantity:t.quantity,name:t.custom_name,description:t.description}),ke=t=>({id:t.id.toString(),name:t.feat_name,description:t.description,isCustom:t.is_custom}),ye=t=>({id:t.id.toString(),name:t.feat_name,description:t.description,isCustom:t.is_custom});class m extends Error{constructor(s,e){super(s+(e!=null&&e.code?` Code: ${e.code}`:"")),this.diagnostics=e}}const v=new le(te,ee),fe=()=>{const{subscribe:t,update:s}=Z({}),e={};let a;const i=(c,g)=>{s(y=>({...y,[c]:{...y[c],...g(y[c])}}))},h=c=>()=>v.removeTrainer(c.id,c.readKey).then(()=>{s(g=>{const{[c.readKey]:y,...T}=g;return T})});return{get:c=>(e[c]==null&&(e[c]=v.getTrainer(c).then(g=>{var I;if(g==null)return;i(g.info.readKey,()=>g);const y=d=>({info:async(n,r={})=>{const _=d.info;let p=n.avatar;r.updateAvatar!=null&&(r.updateAvatar.type==="new"?p=await v.updateTrainerAvatar(d.writeKey,r.updateAvatar.value,n.avatar).catch(o=>{throw k.show(o.message),o}):(await v.removeTrainerAvatar(d.writeKey,n.avatar).catch(o=>{throw k.show(o.message),o}),p=null));const u=o=>i(c,f=>({...f,info:{...f.info,...o,avatar:p}}));return r.optimistic?(u(n),v.updateTrainerInfo(d.writeKey,n).then(()=>{}).catch(o=>{throw u(_),k.show(o.message),o})):v.updateTrainerInfo(d.writeKey,n).then(()=>{u(n)}).catch(o=>{throw k.show(o.message),o})},inventory:n=>v.updateTrainerInventory(d.writeKey,n.inventory).then(r=>{i(c,_=>({..._,info:{..._.info,inventory:r}}))}).catch(r=>{throw k.show(r.message),r}),inventoryItem:(n,r={})=>{let _;const p=u=>{i(c,o=>{const f=o.info.inventory.findIndex(x=>x.id===u.id);return _=o.info.inventory[f],o.info.inventory[f]=u,{...o}})};return r.optimistic?(p(n),v.updateTrainerItem(d.writeKey,n).then(()=>{}).catch(u=>{throw p(_),k.show(u.message),u})):v.updateTrainerItem(d.writeKey,n).then(()=>{p(n)}).catch(u=>{throw k.show(u.message),u})},trainerFeats:n=>v.updateTrainerFeats(d.writeKey,n.feats).then(r=>{i(c,_=>({..._,info:{..._.info,feats:r}}))}).catch(r=>{throw k.show(r.message),r}),retire:()=>v.deleteTrainer(d.writeKey,d.info.id,d.info.readKey).then(()=>{s(n=>{const{[d.info.readKey]:r,..._}=n;return _})}).catch(n=>{throw k.show(n.message),n}),pokemon:async(n,r={})=>{let _,p=n.avatar;r.updateAvatar!=null&&(r.updateAvatar.type==="new"?p=await v.updatePokemonAvatar(d.writeKey,n,r.updateAvatar.value).catch(o=>{throw k.show(o.message),o}):(await v.removePokemonAvatar(d.writeKey,n).catch(o=>{throw k.show(o.message),o}),p=null));const u=o=>i(c,f=>{const x=[...f.pokemon],z=x.findIndex(L=>L.id===o.id);return _=x[z],x[z]={...f.pokemon[z],...o,avatar:p},{...f,pokemon:x}});return r.optimistic?(u(n),v.updatePokemon(d.writeKey,n).then(()=>{}).catch(o=>{throw u(_),k.show(o.message),o})):v.updatePokemon(d.writeKey,n).then(()=>{u(n)}).catch(o=>{throw k.show(o.message),o})},moveset:n=>v.updateMoveset(d.writeKey,n.id,n.moves).then(r=>{i(c,_=>{const p=[..._.pokemon],u=p.findIndex(o=>o.id===n.id);return p[u]={..._.pokemon[u],moves:r},{..._,pokemon:p}})}).catch(r=>{throw k.show(r.message),r}),move:(n,r={})=>{let _;const p=u=>{i(c,o=>{const f=o.pokemon.find(z=>z.moves.map(L=>L.id).includes(u.id));if(!f)return o;const x=f.moves.findIndex(z=>z.id===u.id);return _=f.moves[x],f.moves[x]=u,{...o}})};return r.optimistic?(p(n),v.updateOneMove(d.writeKey,n).then(()=>{}).catch(u=>{throw p(_),k.show(u.message),u})):v.updateOneMove(d.writeKey,n).then(()=>{p(n)}).catch(u=>{throw k.show(u.message),u})},heldItems:n=>v.updateAllHeldItems(d.writeKey,n.id,n.items).then(r=>{i(c,_=>{const p=[..._.pokemon],u=p.findIndex(o=>o.id===n.id);return p[u]={..._.pokemon[u],items:r},{..._,pokemon:p}})}).catch(r=>{throw k.show(r.message),r}),pokemonFeats:n=>v.updatePokemonFeats(d.writeKey,n.id,n.feats).then(r=>{i(c,_=>{const p=[..._.pokemon],u=p.findIndex(o=>o.id===n.id);return p[u]={..._.pokemon[u],feats:r},{..._,pokemon:p}})}).catch(r=>{throw k.show(r.message),r}),addToTeam:n=>v.addPokemonToTeam(d.writeKey,d.info.id,n).then(r=>(i(c,_=>{const p=[..._.pokemon,r];return{..._,pokemon:p}}),r)).catch(r=>{throw k.show(r.message),r}),removeFromTeam:n=>v.removePokemon(d.writeKey,n).then(()=>{i(c,r=>{const _=r.pokemon.filter(p=>p.id!==n);return{...r,pokemon:_}})}).catch(r=>{throw k.show(r.message),r})});let T;((I=g.writeKey)==null?void 0:I.length)>0&&(T=y(g));let w=!1;return{subscribe:d=>t(n=>{d(n[c]??{...g,update:T,remove:h(g.info)}),w||(w=!0,s(r=>({...r,[c]:{...g,update:T,remove:h(g.info)}})))}),verifyAccess:d=>v.verifyWriteKey(g.info,d).then(n=>(n&&i(c,r=>({...r,writeKey:d,update:y({...r,writeKey:d})})),n))}})),e[c]),all:()=>(a==null&&(a=v.allTrainers().then(c=>{let g=!1;return{subscribe:y=>t(T=>{y(Object.values(T).map(w=>w.info)),g||(g=!0,s(w=>c.reduce((I,d)=>({[d.readKey]:{info:d,pokemon:[],remove:h(d)},...I}),w)))})}})),a),new:c=>v.newTrainer(c).then(g=>(i(g.info.readKey,()=>g),g))}},Ue=fe();export{q as N,S as P,$ as S,b as T,Ue as t};
