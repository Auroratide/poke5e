var H=Object.defineProperty;var W=(a,t,e)=>t in a?H(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>W(a,typeof t!="symbol"?t+"":t,e);import{s as $}from"./Bpj21dPT.js";import{b as S,c as I,d as C,H as z,e as U,i as q,u as M}from"./CIB9ZFTq.js";import"./Pu_lP7-t.js";import{a3 as A}from"./CDFLjuqR.js";import"./BxlXVsHr.js";import"./BHr3Jov9.js";import{d as j}from"./DNTgK4in.js";import{r as B}from"./Dtc3I1Sc.js";import{A as T}from"./BsiqRlYd.js";import{P as b}from"./DLn0St_8.js";import{D as N}from"./Bf-g66YD.js";import"./CdRAs_Ty.js";import{P as F}from"./ATOTVc99.js";import"./B1_3h3uv.js";/* empty css        */import"./BMmmFbWz.js";import{a as V}from"./JuRZtsSX.js";import{L as k}from"./C2DumLO3.js";import{S as G,a as Y}from"./BBZo1ta1.js";const J="stellar",m=class m extends N{};n(m,"list",[].concat(b.list).concat(J)),n(m,"isTeraType",t=>m.list.includes(t));let g=m;const f=()=>{var a,t;return((t=(a=localStorage.getItem("trainers"))==null?void 0:a.split(","))==null?void 0:t.filter(e=>e!==""))??[]},Q=a=>{const t=f(),e=[...new Set(t.concat(a))];localStorage.setItem("trainers",e.join(","))},X=a=>{const e=f().filter(i=>i!==a);localStorage.setItem("trainers",e.join(","))},Z=a=>f().find(t=>P(t)===a),P=a=>localStorage.getItem(`write:${a}`),ee=(a,t)=>{localStorage.setItem(`write:${a}`,t)},ae=a=>{localStorage.removeItem(`write:${a}`)},d={getReadKeys:f,addReadKey:Q,removeReadKey:X,getReadKey:Z,getWriteKey:P,addWriteKey:ee,removeWriteKey:ae};function ie(){return{name:"",resource:0,customFeatures:{level2:{description:""},level5:{name:"",description:""},level9:{name:"",description:""},level15:{name:"",description:""}}}}const R=j(B,a=>a==="2018"?G:Y);class D extends N{isStandard(){return A(R).includes(this.data)}}const y="trainer_avatars";class te{constructor(t,e){n(this,"allTrainers",async()=>Promise.all(d.getReadKeys().map(t=>this.getOneTrainerInfo(t))).then(t=>t.filter(e=>e!=null)));n(this,"getTrainer",async t=>{const e=await this.getOneTrainerInfo(t);if(!e)return;d.addReadKey(t);const i=await this.getTrainersPokemon(e.id),s=d.getWriteKey(t);return{info:e,pokemon:i,writeKey:s}});n(this,"getOneTrainerInfo",async t=>{const e=await this.supabase.rpc("get_trainer",{_read_key:t}).maybeSingle().then(({data:_,error:c})=>{if(c)throw new r("Could not get trainer.",c);if(_)return se(_,this.getStorageResource)});if(e==null)return;const[i,s]=await Promise.all([this.getTrainerInventory(e.readKey),this.getTrainerFeats(e.readKey)]);return e.inventory=i,e.feats=s,e});n(this,"getTrainersPokemon",async t=>await this.supabase.rpc("get_pokemon",{_trainer_id:t}).select().then(({data:e,error:i})=>{if(i)throw new r("Could not trainer's pokemon.",i);return e.map(s=>ne(s,this.getUserAssetResource))}).then(e=>Promise.all(e.map(i=>this.getMoveset(i.id).then(s=>({...i,moves:s}))))).then(e=>Promise.all(e.map(i=>this.getHeldItems(i.id).then(s=>({...i,items:s}))))).then(e=>Promise.all(e.map(i=>this.getPokemonFeats(i.id).then(s=>({...i,feats:s}))))));n(this,"newTrainer",async t=>{const e={...t,level:new k(1),ac:10,hp:{current:8,max:8},hitDice:{current:1,max:1},attributes:new T({str:10,dex:10,con:10,int:10,wis:10,cha:10}),proficiencies:new S({athletics:0,acrobatics:0,"sleight of hand":0,stealth:0,arcana:0,history:0,investigation:0,nature:0,religion:0,"animal handling":1,insight:0,medicine:0,perception:0,survival:0,deception:0,intimidation:0,performance:0,persuasion:0}),savingThrows:["cha"],biography:{species:"Human",gender:null,age:null,homeRegion:null,background:null},money:0,inventory:[],specializations:{ghost:0,fairy:0,normal:0,fighting:0,flying:0,poison:0,fire:0,grass:0,water:0,electric:0,psychic:0,dark:0,bug:0,ice:0,dragon:0,steel:0,rock:0,ground:0},path:ie(),feats:[]},{data:i,error:s}=await this.supabase.rpc("new_trainer",{_name:e.name,_description:e.description,_level:e.level.data,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_species:e.biography.species,_gender:e.biography.gender,_age:e.biography.age,_home_region:e.biography.homeRegion,_background:e.biography.background,_money:e.money,_special_normal:e.specializations.normal??0,_special_fighting:e.specializations.fighting??0,_special_flying:e.specializations.flying??0,_special_poison:e.specializations.poison??0,_special_ground:e.specializations.ground??0,_special_rock:e.specializations.rock??0,_special_bug:e.specializations.bug??0,_special_ghost:e.specializations.ghost??0,_special_steel:e.specializations.steel??0,_special_fire:e.specializations.fire??0,_special_water:e.specializations.water??0,_special_grass:e.specializations.grass??0,_special_electric:e.specializations.electric??0,_special_psychic:e.specializations.psychic??0,_special_ice:e.specializations.ice??0,_special_dragon:e.specializations.dragon??0,_special_dark:e.specializations.dark??0,_special_fairy:e.specializations.fairy??0,_path_name:e.path.name,_path_resource:e.path.resource,_path_rank_1_name:"",_path_rank_1_desc:e.path.customFeatures.level2.description,_path_rank_2_name:e.path.customFeatures.level5.name,_path_rank_2_desc:e.path.customFeatures.level5.description,_path_rank_3_name:e.path.customFeatures.level9.name,_path_rank_3_desc:e.path.customFeatures.level9.description,_path_rank_4_name:e.path.customFeatures.level15.name,_path_rank_4_desc:e.path.customFeatures.level15.description}).single();if(s)throw new r("Could not create trainer.",s);return d.addReadKey(i.ret_read_key),d.addWriteKey(i.ret_read_key,i.ret_write_key),{info:{...e,id:i.ret_id,readKey:i.ret_read_key},pokemon:[],writeKey:i.ret_write_key}});n(this,"updateTrainerInfo",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("update_trainer",{_write_key:t,_name:e.name,_description:e.description,_level:e.level.data,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_species:e.biography.species,_gender:e.biography.gender,_age:e.biography.age,_home_region:e.biography.homeRegion,_background:e.biography.background,_money:e.money,_special_normal:e.specializations.normal??0,_special_fighting:e.specializations.fighting??0,_special_flying:e.specializations.flying??0,_special_poison:e.specializations.poison??0,_special_ground:e.specializations.ground??0,_special_rock:e.specializations.rock??0,_special_bug:e.specializations.bug??0,_special_ghost:e.specializations.ghost??0,_special_steel:e.specializations.steel??0,_special_fire:e.specializations.fire??0,_special_water:e.specializations.water??0,_special_grass:e.specializations.grass??0,_special_electric:e.specializations.electric??0,_special_psychic:e.specializations.psychic??0,_special_ice:e.specializations.ice??0,_special_dragon:e.specializations.dragon??0,_special_dark:e.specializations.dark??0,_special_fairy:e.specializations.fairy??0,_path_name:e.path.name,_path_resource:e.path.resource,_path_rank_1_name:"",_path_rank_1_desc:e.path.customFeatures.level2.description,_path_rank_2_name:e.path.customFeatures.level5.name,_path_rank_2_desc:e.path.customFeatures.level5.description,_path_rank_3_name:e.path.customFeatures.level9.name,_path_rank_3_desc:e.path.customFeatures.level9.description,_path_rank_4_name:e.path.customFeatures.level15.name,_path_rank_4_desc:e.path.customFeatures.level15.description}).single();if(s)throw new r("Could not update trainer.",s);if(i<=0)throw new r("Either this trainer does not exist or you do not have permission to edit them.");return i>0});n(this,"updateTrainerAvatar",async(t,e,i)=>{const s=await this.generateTrainerAvatarFilename(t,e),{error:_}=await this.supabase.storage.from(y).upload(s,e);if(_)throw new r("Could not upload file for trainer.");return await this.removeOldTrainerAvatar(i),this.getStorageResource(y,s)});n(this,"removeTrainerAvatar",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("remove_trainer_avatar",{_write_key:t}).single();if(i!=null&&i<=0)throw new r("You do not have permission to edit this trainer.");if(s)throw new r("Could not remove trainer's avatar image",s);await this.removeOldTrainerAvatar(e)});n(this,"generateTrainerAvatarFilename",async(t,e)=>{const i=e.name.split(".").at(-1),{data:s,error:_}=await this.supabase.rpc("new_trainer_avatar_filename",{_write_key:t,_extension:"."+i}).single();if(_)throw new r("Could not generate filename for trainer avatar.",_);return s});n(this,"removeOldTrainerAvatar",async t=>{if(t!=null){const{error:e}=await this.supabase.storage.from(y).remove([t.name]);e&&console.warn("Could not remove old trainer avatar. Ignoring this error.")}});n(this,"removeTrainer",async(t,e)=>{d.removeWriteKey(e),d.removeReadKey(e)});n(this,"deleteTrainer",async(t,e,i)=>{const{data:s,error:_}=await this.supabase.rpc("delete_trainer",{_write_key:t,_id:e}).single();if(_)throw new r("Could not delete trainer.",_);if(s<=0)throw new r("Either this trainer does not exist or you do not have permission to edit them.");return d.removeWriteKey(i),d.removeReadKey(i),s>0});n(this,"updatePokemon",async(t,e)=>{var _;const{data:i,error:s}=await this.supabase.rpc("update_pokemon",{_write_key:t,_id:parseInt(e.id),_species:e.pokemonId.data,_nickname:e.nickname,_type:e.type.data,_nature:e.nature.data,_level:e.level.data,_gender:e.gender,_strength:e.attributes.str.score,_dexterity:e.attributes.dex.score,_constitution:e.attributes.con.score,_intelligence:e.attributes.int.score,_wisdom:e.attributes.wis.score,_charisma:e.attributes.cha.score,_ac:e.ac,_hp_cur:e.hp.current,_hp_max:e.hp.max,_hit_dice_cur:e.hitDice.current,_hit_dice_max:e.hitDice.max,_rank_athletics:e.proficiencies.data.athletics,_rank_acrobatics:e.proficiencies.data.acrobatics,_rank_sleight_of_hand:e.proficiencies.data["sleight of hand"],_rank_stealth:e.proficiencies.data.stealth,_rank_arcana:e.proficiencies.data.arcana,_rank_history:e.proficiencies.data.history,_rank_investigation:e.proficiencies.data.investigation,_rank_nature:e.proficiencies.data.nature,_rank_religion:e.proficiencies.data.religion,_rank_animal_handling:e.proficiencies.data["animal handling"],_rank_insight:e.proficiencies.data.insight,_rank_medicine:e.proficiencies.data.medicine,_rank_perception:e.proficiencies.data.perception,_rank_survival:e.proficiencies.data.survival,_rank_deception:e.proficiencies.data.deception,_rank_intimidation:e.proficiencies.data.intimidation,_rank_performance:e.proficiencies.data.performance,_rank_persuasion:e.proficiencies.data.persuasion,_save_str:e.savingThrows.includes("str"),_save_dex:e.savingThrows.includes("dex"),_save_con:e.savingThrows.includes("con"),_save_int:e.savingThrows.includes("int"),_save_wis:e.savingThrows.includes("wis"),_save_cha:e.savingThrows.includes("cha"),_ability:e.ability??"",_notes:e.notes,_tera_type:e.teraType.data,_exp:e.exp,_status:e.status,_held_item:null,_is_shiny:e.isShiny,_custom_size:e.customSize??null,_hit_dice_size:((_=e.customHitDiceSize)==null?void 0:_.data)??null,_speed_walking:e.speeds.data.walking??null,_speed_climbing:e.speeds.data.climbing??null,_speed_swimming:e.speeds.data.swimming??null,_speed_flying:e.speeds.data.flying??null,_speed_hover:e.speeds.data.hover??null,_speed_burrowing:e.speeds.data.burrowing??null,_sense_darkvision:e.senses.data.darkvision??null,_sense_blindsight:e.senses.data.blindsight??null,_sense_tremorsense:e.senses.data.tremorsense??null,_sense_truesight:e.senses.data.truesight??null,_bond_level:e.bond.level,_bond_points_cur:e.bond.points.current,_bond_points_max:e.bond.points.max}).single();if(s)throw new r("Could not update pokemon.",s);if(i<=0)throw new r("Either this pokemon does not exist or you do not have permission to edit them.");return i>0});n(this,"updatePokemonAvatar",async(t,e,i)=>{const{data:s,error:_}=await this.supabase.functions.invoke("user-assets",{method:"POST",body:{type:"pokemon-avatar",params:{id:e.id,key:t,mimetype:i.type,sizeInBytes:i.size}}});if(_)throw new r("Could not upload file for pokemon.");return await this.userAssets.upload(s.values.uploadUrl,i),this.getUserAssetResource(s.values.filename)});n(this,"removePokemonAvatar",async(t,e)=>{const{error:i}=await this.supabase.functions.invoke("user-assets",{method:"DELETE",body:{type:"pokemon-avatar",params:{id:e.id,key:t}}});if(i)throw console.error(i),new r("Could not delete file for pokemon.")});n(this,"addPokemonToTeam",async(t,e,i)=>{var v,l;const s={trainerId:e,pokemonId:i.id,nickname:i.data.name,type:i.type,nature:new D(A(R)[0]),level:new k(i.data.minLevel),exp:V(i.data.minLevel),gender:F.None,attributes:i.attributes,ac:i.data.ac,ability:(v=i.abilities.toList()[0])==null?void 0:v.id,hp:{current:i.data.hp,max:i.data.hp},hitDice:{current:i.data.minLevel,max:i.data.minLevel},proficiencies:i.skills.copy(),savingThrows:i.data.saves,moves:[],items:[],notes:i.data.notes??"",teraType:new g(i.type.primary),status:null,isShiny:!1,feats:[],customSize:void 0,customHitDiceSize:void 0,speeds:new C({}),senses:new I({}),bond:{level:0,points:{current:0,max:0}}},{data:_,error:c}=await this.supabase.rpc("add_pokemon",{_write_key:t,_nickname:i.data.name,_species:i.id.data,_nature:s.nature.data,_type:i.type.data,_level:i.data.minLevel,_gender:F.None,_strength:i.attributes.str.score,_dexterity:i.attributes.dex.score,_constitution:i.attributes.con.score,_intelligence:i.attributes.int.score,_wisdom:i.attributes.wis.score,_charisma:i.attributes.cha.score,_ac:i.data.ac,_hp_cur:i.data.hp,_hp_max:i.data.hp,_hit_dice_cur:i.data.minLevel,_hit_dice_max:i.data.minLevel,_rank_athletics:s.proficiencies.data.athletics,_rank_acrobatics:s.proficiencies.data.acrobatics,_rank_sleight_of_hand:s.proficiencies.data["sleight of hand"],_rank_stealth:s.proficiencies.data.stealth,_rank_arcana:s.proficiencies.data.arcana,_rank_history:s.proficiencies.data.history,_rank_investigation:s.proficiencies.data.investigation,_rank_nature:s.proficiencies.data.nature,_rank_religion:s.proficiencies.data.religion,_rank_animal_handling:s.proficiencies.data["animal handling"],_rank_insight:s.proficiencies.data.insight,_rank_medicine:s.proficiencies.data.medicine,_rank_perception:s.proficiencies.data.perception,_rank_survival:s.proficiencies.data.survival,_rank_deception:s.proficiencies.data.deception,_rank_intimidation:s.proficiencies.data.intimidation,_rank_performance:s.proficiencies.data.performance,_rank_persuasion:s.proficiencies.data.persuasion,_save_str:i.data.saves.includes("str"),_save_dex:i.data.saves.includes("dex"),_save_con:i.data.saves.includes("con"),_save_int:i.data.saves.includes("int"),_save_wis:i.data.saves.includes("wis"),_save_cha:i.data.saves.includes("cha"),_ability:((l=i.abilities.toList()[0])==null?void 0:l.id)??"",_notes:s.notes??"",_tera_type:i.type.primary,_exp:s.exp,_status:null,_held_item:null,_is_shiny:!1,_custom_size:null,_hit_dice_size:null,_speed_walking:null,_speed_climbing:null,_speed_swimming:null,_speed_flying:null,_speed_hover:null,_speed_burrowing:null,_sense_darkvision:null,_sense_blindsight:null,_sense_tremorsense:null,_sense_truesight:null,_bond_level:0,_bond_points_cur:0,_bond_points_max:0}).single();if(c)throw new r("Could not add pokemon.",c);return{...s,id:_.toString()}});n(this,"removePokemon",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("remove_pokemon",{_write_key:t,_id:e}).single();if(s)throw new r("Could not remove pokemon.",s);return i>0});n(this,"updateListOfThings",async({thingName:t,writeKey:e,newThings:i,getExistingThings:s,removeFunctionName:_,updateFunctionName:c,addFunctionName:v,mapThingToDbArgument:l})=>{const w=await s(),K=i.map(o=>o.id),x=w.map(o=>o.id),O=x.filter(o=>!K.includes(o));return await Promise.all(O.map(o=>this.supabase.rpc(_,{_write_key:e,_id:o}).single().then(({data:u,error:p})=>{if(p)throw new r(`Could not delete ${t}.`,p);if(u<=0)throw new r("Either this trainer/pokemon does not exist or you do not have permission to edit them.");return u>0}))),await Promise.all(i.map((o,u)=>x.includes(o.id)?this.supabase.rpc(c,l(o,u,"update")).single().then(({data:p,error:h})=>{if(h)throw new r(`Could not update ${t}.`,h);if(p<=0)throw new r("Either this trainer/pokemon does not exist or you do not have permission to edit them.");return{...o}}):this.supabase.rpc(v,l(o,u,"add")).single().then(({data:p,error:h})=>{if(h)throw new r(`Could not add ${t}.`,h);return{...o,id:p}})))});n(this,"updateMoveset",async(t,e,i)=>this.updateListOfThings({thingName:"move",writeKey:t,newThings:i,getExistingThings:()=>this.getMoveset(e),removeFunctionName:"remove_move",updateFunctionName:"update_move",addFunctionName:"add_move",mapThingToDbArgument:(s,_,c)=>({_write_key:t,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?s.id:void 0,_move_id:s.moveId,_pp_cur:s.pp.current,_pp_max:s.pp.max,_notes:s.notes,_rank:_})}));n(this,"updateOneMove",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("update_move",{_write_key:t,_id:e.id,_move_id:e.moveId,_pp_cur:e.pp.current,_pp_max:e.pp.max,_notes:e.notes}).single();if(s)throw new r("Could not update pokemon.",s);if(i<=0)throw new r("Either this pokemon does not exist or you do not have permission to edit them.");return i>0});n(this,"updateAllHeldItems",async(t,e,i)=>this.updateListOfThings({thingName:"held item",writeKey:t,newThings:i,getExistingThings:()=>this.getHeldItems(e),removeFunctionName:"remove_held_item",updateFunctionName:"update_held_item",addFunctionName:"add_held_item",mapThingToDbArgument:(s,_,c)=>({_write_key:t,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?s.id:void 0,_item_id:s.type==="standard"?s.itemId:null,_custom_name:s.type==="custom"?s.name:null,_description:s.type==="custom"?s.description:null,_rank:_})}));n(this,"updateTrainerInventory",async(t,e)=>this.updateListOfThings({thingName:"inventory item",writeKey:t,newThings:e,getExistingThings:()=>this.getTrainerInventory(d.getReadKey(t)),removeFunctionName:"remove_inventory_item",updateFunctionName:"update_inventory_item",addFunctionName:"add_inventory_item",mapThingToDbArgument:(i,s,_)=>({_write_key:t,_id:_==="update"?i.id:void 0,_item_id:i.type==="standard"?i.itemId:null,_quantity:i.quantity,_custom_name:i.type==="custom"?i.name:null,_description:i.type==="custom"?i.description:null,_rank:s})}));n(this,"updateTrainerFeats",async(t,e)=>this.updateListOfThings({thingName:"feat",writeKey:t,newThings:e,getExistingThings:()=>this.getTrainerFeats(d.getReadKey(t)),removeFunctionName:"remove_trainer_feat",updateFunctionName:"update_trainer_feat",addFunctionName:"add_trainer_feat",mapThingToDbArgument:(i,s,_)=>({_write_key:t,_id:_==="update"?i.id:void 0,_feat_name:i.name,_description:i.description,_is_custom:i.isCustom,_rank:s})}));n(this,"updatePokemonFeats",async(t,e,i)=>this.updateListOfThings({thingName:"feat",writeKey:t,newThings:i,getExistingThings:()=>this.getPokemonFeats(e),removeFunctionName:"remove_pokemon_feat",updateFunctionName:"update_pokemon_feat",addFunctionName:"add_pokemon_feat",mapThingToDbArgument:(s,_,c)=>({_write_key:t,_pokemon_id:c==="add"?e:void 0,_id:c==="update"?s.id:void 0,_feat_name:s.name,_description:s.description,_is_custom:s.isCustom,_rank:_})}));n(this,"updateTrainerItem",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("update_inventory_item",{_write_key:t,_id:e.id,_item_id:e.type==="standard"?e.itemId:null,_quantity:e.quantity,_custom_name:e.type==="custom"?e.name:null,_description:e.type==="custom"?e.description:null}).single();if(s)throw new r("Could not update inventory item.",s);if(i<=0)throw new r("Either this trainer does not exist or you do not have permission to edit them.");return i>0});n(this,"verifyWriteKey",async(t,e)=>{const{data:i,error:s}=await this.supabase.rpc("verify_write_key",{_id:t.id,_write_key:e}).single();if(s)throw new r("Could not verify trainer.",s);return i>0&&d.addWriteKey(t.readKey,e),i>0});n(this,"getMoveset",async t=>{const{data:e,error:i}=await this.supabase.rpc("get_moveset",{_pokemon_id:t}).select();if(i)throw new r("Could not get moveset.",i);return(e==null?void 0:e.map(s=>re(s)))??[]});n(this,"getHeldItems",async t=>{const{data:e,error:i}=await this.supabase.rpc("get_held_items",{_pokemon_id:t}).select();if(i)throw new r("Could not get held items.",i);return(e==null?void 0:e.map(s=>_e(s)))??[]});n(this,"getTrainerInventory",async t=>{const{data:e,error:i}=await this.supabase.rpc("get_inventory_items",{_read_key:t}).select();if(i)throw new r("Could not get inventory items.",i);return(e==null?void 0:e.map(s=>ce(s)))??[]});n(this,"getTrainerFeats",async t=>{const{data:e,error:i}=await this.supabase.rpc("get_trainer_feats",{_read_key:t}).select();if(i)throw new r("Could not get trainer feats.",i);return(e==null?void 0:e.map(s=>oe(s)))??[]});n(this,"getPokemonFeats",async t=>{const{data:e,error:i}=await this.supabase.rpc("get_pokemon_feats",{_pokemon_id:t}).select();if(i)throw new r("Could not get pokemon feats.",i);return(e==null?void 0:e.map(s=>de(s)))??[]});n(this,"getStorageResource",(t,e)=>({name:e,href:this.supabase.storage.from(t).getPublicUrl(e).data.publicUrl}));n(this,"getUserAssetResource",t=>({name:t,href:this.userAssets.getAssetUrl(t)}));this.supabase=t,this.userAssets=e}}const se=(a,t)=>({id:a.id,readKey:a.read_key,name:a.name,description:a.description,level:new k(a.level),attributes:new T({str:a.strength,dex:a.dexterity,con:a.constitution,int:a.intelligence,wis:a.wisdom,cha:a.charisma}),ac:a.ac,hp:{current:a.hp_cur,max:a.hp_max},hitDice:{current:a.hit_dice_cur,max:a.hit_dice_max},proficiencies:L({athletics:[a.prof_athletics,a.rank_athletics],acrobatics:[a.prof_acrobatics,a.rank_acrobatics],"sleight of hand":[a.prof_sleight_of_hand,a.rank_sleight_of_hand],stealth:[a.prof_stealth,a.rank_stealth],arcana:[a.prof_arcana,a.rank_arcana],history:[a.prof_history,a.rank_history],investigation:[a.prof_investigation,a.rank_investigation],nature:[a.prof_nature,a.rank_nature],religion:[a.prof_religion,a.rank_religion],"animal handling":[a.prof_animal_handling,a.rank_animal_handling],insight:[a.prof_insight,a.rank_insight],medicine:[a.prof_medicine,a.rank_medicine],perception:[a.prof_perception,a.rank_perception],survival:[a.prof_survival,a.rank_survival],deception:[a.prof_deception,a.rank_deception],intimidation:[a.prof_intimidation,a.rank_intimidation],performance:[a.prof_performance,a.rank_performance],persuasion:[a.prof_persuasion,a.rank_persuasion]}),savingThrows:E({str:a.save_str,dex:a.save_dex,con:a.save_con,int:a.save_int,wis:a.save_wis,cha:a.save_cha}),biography:{species:a.species,gender:a.gender,age:a.age,homeRegion:a.home_region,background:a.background},money:a.money,inventory:[],avatar:a.avatar_filename!=null?t(y,a.avatar_filename):null,specializations:{normal:a.special_normal,fighting:a.special_fighting,flying:a.special_flying,poison:a.special_poison,ground:a.special_ground,rock:a.special_rock,bug:a.special_bug,ghost:a.special_ghost,steel:a.special_steel,fire:a.special_fire,water:a.special_water,grass:a.special_grass,electric:a.special_electric,psychic:a.special_psychic,ice:a.special_ice,dragon:a.special_dragon,dark:a.special_dark,fairy:a.special_fairy},path:{name:a.path_name,resource:a.path_resource,customFeatures:{level2:{description:a.path_rank_1_desc},level5:{name:a.path_rank_2_name,description:a.path_rank_2_desc},level9:{name:a.path_rank_3_name,description:a.path_rank_3_desc},level15:{name:a.path_rank_4_name,description:a.path_rank_4_desc}}},feats:[]}),E=a=>Object.entries(a).filter(([,t])=>t).map(([t])=>t),L=a=>new S(Object.entries(a).reduce((t,[e,[i,s]])=>({...t,[e]:s>0?s:i?1:0}),{})),ne=(a,t)=>({id:a.id.toString(),trainerId:a.trainer_id,pokemonId:new U(a.species),nickname:a.nickname,type:new b(a.type.filter(b.isPokeType)),nature:new D(a.nature),level:new k(a.level),exp:a.exp,gender:a.gender,attributes:new T({str:a.strength,dex:a.dexterity,con:a.constitution,int:a.intelligence,wis:a.wisdom,cha:a.charisma}),ac:a.ac,hp:{current:a.hp_cur,max:a.hp_max},hitDice:{current:a.hit_dice_cur,max:a.hit_dice_max},ability:a.ability,proficiencies:L({athletics:[a.prof_athletics,a.rank_athletics],acrobatics:[a.prof_acrobatics,a.rank_acrobatics],"sleight of hand":[a.prof_sleight_of_hand,a.rank_sleight_of_hand],stealth:[a.prof_stealth,a.rank_stealth],arcana:[a.prof_arcana,a.rank_arcana],history:[a.prof_history,a.rank_history],investigation:[a.prof_investigation,a.rank_investigation],nature:[a.prof_nature,a.rank_nature],religion:[a.prof_religion,a.rank_religion],"animal handling":[a.prof_animal_handling,a.rank_animal_handling],insight:[a.prof_insight,a.rank_insight],medicine:[a.prof_medicine,a.rank_medicine],perception:[a.prof_perception,a.rank_perception],survival:[a.prof_survival,a.rank_survival],deception:[a.prof_deception,a.rank_deception],intimidation:[a.prof_intimidation,a.rank_intimidation],performance:[a.prof_performance,a.rank_performance],persuasion:[a.prof_persuasion,a.rank_persuasion]}),savingThrows:E({str:a.save_str,dex:a.save_dex,con:a.save_con,int:a.save_int,wis:a.save_wis,cha:a.save_cha}),moves:[],items:[],notes:a.notes,teraType:g.isTeraType(a.tera_type)?new g(a.tera_type):void 0,status:a.status,isShiny:a.is_shiny,feats:[],customSize:q(a.custom_size)?a.custom_size:void 0,customHitDiceSize:z.isHitDice(a.hit_dice_size)?new z(a.hit_dice_size):void 0,speeds:new C({walking:a.speed_walking,climbing:a.speed_climbing,swimming:a.speed_swimming,flying:a.speed_flying,hover:a.speed_hover,burrowing:a.speed_burrowing}),senses:new I({darkvision:a.sense_darkvision,blindsight:a.sense_blindsight,tremorsense:a.sense_tremorsense,truesight:a.sense_truesight}),bond:{level:a.bond_level,points:{current:a.bond_points_cur,max:a.bond_points_max}},avatar:a.avatar_filename?t(a.avatar_filename):void 0}),re=a=>({id:a.id.toString(),moveId:a.move_id,pp:{current:a.pp_cur,max:a.pp_max},notes:a.notes}),_e=a=>({id:a.id.toString(),type:a.item_id!=null?"standard":"custom",itemId:a.item_id,name:a.custom_name,description:a.description}),ce=a=>({id:a.id.toString(),type:a.item_id!=null?"standard":"custom",itemId:a.item_id,quantity:a.quantity,name:a.custom_name,description:a.description}),oe=a=>({id:a.id.toString(),name:a.feat_name,description:a.description,isCustom:a.is_custom}),de=a=>({id:a.id.toString(),name:a.feat_name,description:a.description,isCustom:a.is_custom});class r extends Error{constructor(t,e){super(t+(e!=null&&e.code?` Code: ${e.code}`:"")),this.diagnostics=e}}const Pe=new te($,M);export{D as N,g as P,R as S,d as T,Pe as p};
